<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FMCG Asset Management - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô FMCG</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background: #f0f9f9;
            overflow-x: hidden;
        }

        /* Teal Color Scheme */
        :root {
            --primary: #14b8a6;
            --primary-dark: #0d9488;
            --primary-light: #5eead4;
            --secondary: #06b6d4;
            --accent: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 20px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 3px 0 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .logo {
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            white-space: nowrap;
            border-bottom: 2px solid rgba(255,255,255,0.2);
            padding-bottom: 20px;
        }

        .logo i {
            font-size: 32px;
            animation: logoFloat 3s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.5));
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-5px) rotate(5deg); }
        }

        .sidebar.collapsed .logo span,
        .sidebar.collapsed .menu-item span {
            display: none;
        }

        .menu-item {
            color: rgba(255,255,255,0.8);
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 15px;
            transition: all 0.3s ease;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }

        .menu-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: white;
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .menu-item:hover {
            background: rgba(255,255,255,0.15);
            color: white;
            transform: translateX(5px);
        }

        .menu-item:hover::before {
            transform: scaleY(1);
        }

        .menu-item:hover i {
            transform: scale(1.1);
        }

        .menu-item.active {
            background: white;
            color: var(--primary);
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .menu-item.active::before {
            display: none;
        }

        .menu-item i {
            font-size: 18px;
            width: 25px;
            transition: transform 0.3s ease;
        }

        .menu-toggle {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .menu-toggle:hover {
            background: rgba(255,255,255,0.35);
            transform: translateX(-50%) scale(1.1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .menu-toggle i {
            transition: transform 0.3s ease;
        }

        .sidebar.collapsed .menu-toggle i {
            transform: rotate(180deg);
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            padding: 20px;
            min-height: 100vh;
            transition: all 0.3s;
        }

        .sidebar.collapsed + .main-content {
            margin-left: 70px;
        }

        /* Header */
        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #333;
            font-size: 26px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--accent) 0%, #059669 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
            color: white;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-info {
            background: linear-gradient(135deg, var(--secondary) 0%, #0891b2 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: #f8f9fa;
            border-radius: 25px;
            cursor: pointer;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Page Container */
        .page {
            display: none;
            animation: fadeIn 0.3s;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            color: white;
        }

        .stat-icon.teal { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); }
        .stat-icon.green { background: linear-gradient(135deg, var(--accent) 0%, #059669 100%); }
        .stat-icon.cyan { background: linear-gradient(135deg, var(--secondary) 0%, #0891b2 100%); }
        .stat-icon.orange { background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%); }
        .stat-icon.red { background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%); }

        .stat-info h3 {
            font-size: 28px;
            color: #333;
            font-weight: bold;
        }

        .stat-info p {
            color: #888;
            font-size: 14px;
            margin-top: 5px;
        }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .chart-card h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Card Grid for Department Cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        /* Table */
        .table-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow-x: auto;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .table-header h2 {
            color: #333;
            font-size: 18px;
        }

        .search-box {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .search-box input {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            width: 250px;
            font-size: 14px;
        }

        .search-box select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8f9fa;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
            color: #666;
        }

        tbody tr {
            transition: all 0.3s;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }

        .badge.available {
            background: #d1fae5;
            color: #065f46;
        }

        .badge.in-use {
            background: #fef3c7;
            color: #92400e;
        }

        .badge.maintenance {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge.retired {
            background: #e2e3e5;
            color: #383d41;
        }

        /* New warehouse status badges */
        .badge.complete {
            background: #d1fae5;
            color: #065f46;
        }

        .badge.repair {
            background: #fef3c7;
            color: #92400e;
        }

        .badge.damaged {
            background: #fed7aa;
            color: #9a3412;
        }

        .badge.broken {
            background: #fee2e2;
            color: #991b1b;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 5px;
            transition: all 0.3s;
        }

        .action-btn:hover {
            transform: scale(1.05);
        }

        .action-btn.view {
            background: #e0f2fe;
            color: #075985;
        }

        .action-btn.primary {
            background: #ccfbf1;
            color: #0f766e;
        }

        .action-btn.edit {
            background: #d1fae5;
            color: #065f46;
        }

        .action-btn.delete {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-header h3 {
            color: #333;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal {
            width: 35px;
            height: 35px;
            border: none;
            background: #f5f5f5;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: #e0e0e0;
            transform: rotate(90deg);
        }

        /* Form */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            color: #333;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .form-group label .required {
            color: var(--danger);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* Upload Area */
        .upload-area {
            border: 2px dashed var(--primary);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: #f0fdfa;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            background: #ccfbf1;
            border-color: var(--primary-dark);
        }

        .upload-area i {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .upload-area p {
            color: #666;
            margin-bottom: 10px;
        }

        .upload-area .btn {
            margin-top: 10px;
        }

        /* Google Sheets Config */
        .config-box {
            background: #f0fdfa;
            border: 1px solid var(--primary-light);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .config-box h3 {
            color: var(--primary-dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .config-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }

        .config-status.connected {
            background: #d1fae5;
            color: #065f46;
        }

        .config-status.disconnected {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            display: none;
            animation: slideIn 0.3s;
            z-index: 3000;
            min-width: 300px;
        }

        .notification.active {
            display: block;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }

        .notification.success {
            border-left: 4px solid var(--accent);
        }

        .notification.error {
            border-left: 4px solid var(--danger);
        }

        .notification.warning {
            border-left: 4px solid var(--warning);
        }

        /* Loading */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }

            .sidebar .logo span,
            .sidebar .menu-item span {
                display: none;
            }

            .main-content {
                margin-left: 70px;
            }

            .stats-grid,
            .charts-grid,
            .card-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 15px;
            }

            .table-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .search-box {
                width: 100%;
            }

            .search-box input,
            .search-box select {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Notification -->
    <div id="notification" class="notification">
        <div style="display: flex; align-items: start; gap: 15px;">
            <i class="fas fa-check-circle" style="font-size: 24px; color: var(--accent);"></i>
            <div>
                <h4 id="notificationTitle" style="margin-bottom: 5px;">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h4>
                <p id="notificationMessage" style="color: #666; font-size: 14px;">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="logo">
            <i class="fas fa-cube"></i>
            <span>FMCG Asset</span>
        </div>
        
        <div class="menu-item active" onclick="showPage('dashboard')">
            <i class="fas fa-house"></i>
            <span>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</span>
        </div>
        
        <div class="menu-item" onclick="showPage('assets')">
            <i class="fas fa-boxes-stacked"></i>
            <span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</span>
        </div>

        <div class="menu-item" onclick="showPage('add-asset')">
            <i class="fas fa-square-plus"></i>
            <span>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</span>
        </div>
        
        <div class="menu-item" onclick="showPage('departments')">
            <i class="fas fa-building"></i>
            <span>‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</span>
        </div>

        <div class="menu-item" onclick="showPage('locations')">
            <i class="fas fa-map-location-dot"></i>
            <span>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö</span>
        </div>
        
        <div class="menu-item" onclick="showPage('maintenance')">
            <i class="fas fa-wrench"></i>
            <span>‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤</span>
        </div>
        
        <div class="menu-item" onclick="showPage('reports')">
            <i class="fas fa-chart-pie"></i>
            <span>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span>
        </div>
        
        <div class="menu-item" onclick="showPage('settings')">
            <i class="fas fa-sliders"></i>
            <span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
        </div>

        <button class="menu-toggle" onclick="toggleSidebar()">
            <i class="fas fa-angles-left"></i>
        </button>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Page -->
        <div id="dashboard" class="page active">
            <div class="header">
                <h1><i class="fas fa-home"></i> ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î FMCG</h1>
                <div class="header-actions">
                    <button class="btn btn-info" onclick="showPage('import')">
                        <i class="fas fa-file-excel"></i>
                        Import Excel
                    </button>
                    <button class="btn btn-success" onclick="showPage('add-asset')">
                        <i class="fas fa-plus"></i>
                        ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô
                    </button>
                    </div>
            </div>

            <!-- Google Sheets Status -->
            <div class="config-box">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3><i class="fas fa-database"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</h3>
                        <p id="sheetsStatus" style="color: #666; margin-top: 5px;">
                            <span class="config-status disconnected">
                                <i class="fas fa-times-circle"></i>
                                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                            </span>
                        </p>
                    </div>
                    <button class="btn btn-primary" onclick="showPage('settings')">
                        <i class="fas fa-cog"></i>
                        ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                    </button>
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card" onclick="showPage('assets')">
                    <div class="stat-icon teal">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalAssets">0</h3>
                        <p>‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon green">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="availableAssets">0</h3>
                        <p>‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon cyan">
                        <i class="fas fa-tools"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="inUseAssets">0</h3>
                        <p>‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°</p>
                    </div>
                </div>

                <div class="stat-card" onclick="showPage('maintenance')">
                    <div class="stat-icon orange">
                        <i class="fas fa-wrench"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="maintenanceAssets">0</h3>
                        <p>‡∏ä‡∏≥‡∏£‡∏∏‡∏î/‡πÄ‡∏™‡∏µ‡∏¢</p>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h2><i class="fas fa-chart-pie"></i> ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h2>
                    <canvas id="categoryChart"></canvas>
                </div>

                <div class="chart-card">
                    <h2><i class="fas fa-chart-bar"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</h2>
                    <canvas id="statusDashChart"></canvas>
                </div>
            </div>

            <!-- Recent Assets -->
            <div class="table-container">
                <div class="table-header">
                    <h2><i class="fas fa-clock"></i> ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
                    <button class="btn btn-primary" onclick="showPage('assets')">
                        ‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <i class="fas fa-arrow-right"></i>
                    </button>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>‡∏£‡∏´‡∏±‡∏™</th>
                            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</th>
                            <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            <th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ø)</th>
                        </tr>
                    </thead>
                    <tbody id="recentAssetsTable">
                        <tr>
                            <td colspan="5" style="text-align: center; color: #aaa; padding: 40px;">
                                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠ Import Excel
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Assets List Page -->
        <div id="assets" class="page">
            <div class="header">
                <h1><i class="fas fa-boxes"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</h1>
                <div class="header-actions">
                    <button class="btn btn-info" onclick="loadFromGoogleSheets()">
                        <i class="fas fa-sync"></i>
                        Sync
                    </button>
                    <button class="btn btn-success" onclick="showPage('add-asset')">
                        <i class="fas fa-plus"></i>
                        ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô
                    </button>
                    <button class="btn btn-primary" onclick="exportToExcel()">
                        <i class="fas fa-file-export"></i>
                        Export
                    </button>
                </div>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <h2>‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (<span id="assetCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h2>
                    <div class="search-box">
                        <input type="text" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." id="searchAsset" onkeyup="filterAssets()">
                        <select id="filterCategory" onchange="filterAssets()">
                            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="‡∏û‡∏≤‡πÄ‡∏•‡∏ó">‡∏û‡∏≤‡πÄ‡∏•‡∏ó</option>
                            <option value="TOTE">TOTE</option>
                            <option value="‡∏ï‡∏∞‡πÅ‡∏Å‡∏£‡∏á‡∏Å‡∏£‡∏á">‡∏ï‡∏∞‡πÅ‡∏Å‡∏£‡∏á‡∏Å‡∏£‡∏á</option>
                            <option value="RF Scanner">RF Scanner</option>
                            <option value="IData">IData</option>
                            <option value="‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà RF">‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà RF</option>
                            <option value="‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà IData">‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà IData</option>
                            <option value="‡∏ß‡∏¥‡∏ó‡∏¢‡∏∏‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£">‡∏ß‡∏¥‡∏ó‡∏¢‡∏∏‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£</option>
                            <option value="Cutter Safety">Cutter Safety</option>
                            <option value="‡∏£‡∏ñ‡πÇ‡∏ü‡∏•‡πå‡∏Ñ‡∏•‡∏¥‡∏ü‡∏ó‡πå">‡∏£‡∏ñ‡πÇ‡∏ü‡∏•‡πå‡∏Ñ‡∏•‡∏¥‡∏ü‡∏ó‡πå</option>
                            <option value="‡∏ä‡∏±‡πâ‡∏ô‡∏ß‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">‡∏ä‡∏±‡πâ‡∏ô‡∏ß‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                            <option value="‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏•‡∏±‡∏á">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏•‡∏±‡∏á</option>
                            <option value="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£</option>
                        </select>
                        <select id="filterStatus" onchange="filterAssets()">
                            <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                            <option value="‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå">‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</option>
                            <option value="‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°">‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°</option>
                            <option value="‡∏ä‡∏≥‡∏£‡∏∏‡∏î">‡∏ä‡∏≥‡∏£‡∏∏‡∏î</option>
                            <option value="‡πÄ‡∏™‡∏µ‡∏¢">‡πÄ‡∏™‡∏µ‡∏¢</option>
                        </select>
                    </div>
                </div>

                <table id="assetsTable">
                    <thead>
                        <tr>
                            <th>‡∏£‡∏´‡∏±‡∏™</th>
                            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</th>
                            <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</th>
                            <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            <th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ø)</th>
                            <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="assetsTableBody">
                        <tr>
                            <td colspan="8" style="text-align: center; color: #aaa; padding: 40px;">
                                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠ Import Excel
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Add Asset Page -->
        <div id="add-asset" class="page">
            <div class="header">
                <h1><i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà</h1>
                <div class="header-actions">
                    <button class="btn btn-warning" onclick="showImportSection()">
                        <i class="fas fa-file-excel"></i>
                        Import ‡∏à‡∏≤‡∏Å Excel
                    </button>
                    <button class="btn btn-secondary" onclick="showPage('assets')">
                        <i class="fas fa-arrow-left"></i>
                        ‡∏Å‡∏•‡∏±‡∏ö
                    </button>
                    <button class="btn btn-success" onclick="saveNewAsset()">
                        <i class="fas fa-save"></i>
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                </div>
            </div>

            <!-- Import Excel Section -->
            <div id="importSection" style="display: none; margin-bottom: 30px;">
                <div class="table-container" style="background: #fff3cd; border: 2px solid #ffc107;">
                    <h2 style="margin-bottom: 20px; color: #856404;">
                        <i class="fas fa-file-excel"></i> Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Excel
                    </h2>
                    
                    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <input type="file" id="excelFileInput" accept=".xlsx, .xls" style="flex: 1; min-width: 250px; padding: 10px; border: 2px dashed #ffc107; border-radius: 8px; background: white;">
                        
                        <button class="btn btn-primary" onclick="processExcelFile()">
                            <i class="fas fa-upload"></i>
                            ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
                        </button>
                        
                        <button class="btn btn-secondary" onclick="hideImportSection()">
                            <i class="fas fa-times"></i>
                            ‡∏õ‡∏¥‡∏î
                        </button>
                    </div>

                    <div style="margin-top: 15px; padding: 10px; background: white; border-radius: 8px;">
                        <small style="color: #856404;">
                            <i class="fas fa-info-circle"></i> 
                            <strong>‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå:</strong> .xlsx, .xls | 
                            <strong>‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ:</strong> ‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô, ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô, ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà, ‡∏£‡∏≤‡∏Ñ‡∏≤
                        </small>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <h2 style="margin-bottom: 25px;">
                    <i class="fas fa-info-circle"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô
                </h2>

                <div class="form-grid">
                    <div class="form-group">
                        <label>‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô <span class="required">*</span></label>
                        <input type="text" id="newAssetCode" placeholder="‡πÄ‡∏ä‡πà‡∏ô PLT-001" required>
                    </div>

                    <div class="form-group">
                        <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà <span class="required">*</span></label>
                        <select id="newCategory" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                            <option>‡∏û‡∏≤‡πÄ‡∏•‡∏ó</option>
                            <option>TOTE</option>
                            <option>‡∏ï‡∏∞‡πÅ‡∏Å‡∏£‡∏á‡∏Å‡∏£‡∏á</option>
                            <option>RF Scanner</option>
                            <option>IData</option>
                            <option>‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà RF</option>
                            <option>‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà IData</option>
                            <option>‡∏ß‡∏¥‡∏ó‡∏¢‡∏∏‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£</option>
                            <option>Cutter Safety</option>
                            <option>‡∏£‡∏ñ‡πÇ‡∏ü‡∏•‡πå‡∏Ñ‡∏•‡∏¥‡∏ü‡∏ó‡πå</option>
                            <option>‡∏ä‡∏±‡πâ‡∏ô‡∏ß‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                            <option>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏•‡∏±‡∏á</option>
                            <option>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£</option>
                            <option>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô <span class="required">*</span></label>
                        <input type="text" id="newAssetName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô" required>
                    </div>

                    <div class="form-group">
                        <label>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</label>
                        <input type="text" id="newBrand" placeholder="‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠">
                    </div>

                    <div class="form-group">
                        <label>‡∏£‡∏∏‡πà‡∏ô</label>
                        <input type="text" id="newModel" placeholder="‡∏£‡∏∏‡πà‡∏ô">
                    </div>

                    <div class="form-group">
                        <label>Serial Number</label>
                        <input type="text" id="newSerial" placeholder="Serial Number">
                    </div>

                    <div class="form-group">
                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠ <span class="required">*</span></label>
                        <input type="date" id="newPurchaseDate" required>
                    </div>

                    <div class="form-group">
                        <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ø) <span class="required">*</span></label>
                        <input type="number" id="newPrice" placeholder="0.00" required>
                    </div>

                    <div class="form-group">
                        <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö <span class="required">*</span></label>
                        <select id="newLocation" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</option>
                            <option>‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - ‡πÇ‡∏ã‡∏ô A</option>
                            <option>‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - ‡πÇ‡∏ã‡∏ô B</option>
                            <option>‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - ‡πÇ‡∏ã‡∏ô C</option>
                            <option>‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏≠‡∏á</option>
                            <option>‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>‡πÅ‡∏ú‡∏ô‡∏Å</label>
                        <select id="newDepartment">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</option>
                            <option>‡∏™‡∏≥‡∏£‡∏≠‡∏á</option>
                            <option>AC</option>
                            <option>AP</option>
                            <option>APB</option>
                            <option>CF</option>
                            <option>APL</option>
                            <option>CP</option>
                            <option>DP</option>
                            <option>INV</option>
                            <option>LS</option>
                            <option>QA</option>
                            <option>RC</option>
                            <option>ST</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                        <select id="newStatus">
                            <option>‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</option>
                            <option>‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°</option>
                            <option>‡∏ä‡∏≥‡∏£‡∏∏‡∏î</option>
                            <option>‡πÄ‡∏™‡∏µ‡∏¢</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</label>
                        <textarea id="newDescription" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..."></textarea>
                    </div>
                </div>

                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="showPage('assets')">
                        <i class="fas fa-times"></i>
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                    <button class="btn btn-success" onclick="saveNewAsset()">
                        <i class="fas fa-save"></i>
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô
                    </button>
                </div>
            </div>
        </div>

        <!-- Import Excel Page -->
        <div id="import" class="page">
            <div class="header">
                <h1><i class="fas fa-file-excel"></i> Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Excel</h1>
                <div class="header-actions">
                    <button class="btn btn-success" onclick="downloadTemplate()">
                        <i class="fas fa-download"></i>
                        ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Template
                    </button>
                </div>
            </div>

            <div class="table-container">
                <h2 style="margin-bottom: 20px;">
                    <i class="fas fa-cloud-upload-alt"></i> ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel
                </h2>
                
                <div class="upload-area" onclick="document.getElementById('excelFile').click()">
                    <input type="file" id="excelFile" accept=".xlsx, .xls" style="display: none;" onchange="handleFileUpload(event)">
                    <i class="fas fa-file-excel"></i>
                    <h3>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel</h3>
                    <p>‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå .xlsx ‡πÅ‡∏•‡∏∞ .xls</p>
                    <button class="btn btn-primary" onclick="event.stopPropagation();">
                        <i class="fas fa-folder-open"></i>
                        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
                    </button>
                </div>

                <div style="margin-top: 30px; padding: 20px; background: #fef3c7; border-radius: 10px; border-left: 4px solid var(--warning);">
                    <h4 style="color: #92400e; margin-bottom: 10px;">
                        <i class="fas fa-info-circle"></i> ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                    </h4>
                    <ol style="color: #92400e; padding-left: 20px; line-height: 1.8;">
                        <li>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Template Excel ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</li>
                        <li>‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏•‡∏á‡πÉ‡∏ô Template ‡∏ï‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î</li>
                        <li>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel ‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</li>
                        <li>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
                    </ol>
                </div>
            </div>

            <div id="previewSection" style="display: none;">
                <div style="height: 30px;"></div>
                <div class="table-container">
                    <div class="table-header">
                        <h2><i class="fas fa-eye"></i> ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</h2>
                        <button class="btn btn-success" onclick="confirmImport()">
                            <i class="fas fa-check"></i>
                            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
                        </button>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>‡∏£‡∏´‡∏±‡∏™</th>
                                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</th>
                                <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
                                <th>‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ø)</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            </tr>
                        </thead>
                        <tbody id="previewTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Departments Breakdown Page -->
        <div id="departments" class="page">
            <div class="header">
                <h1><i class="fas fa-building"></i> ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</h1>
                <div class="header-actions">
                    <button class="btn btn-success" onclick="exportDepartmentReport()">
                        <i class="fas fa-file-excel"></i>
                        Export ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                    </button>
                </div>
            </div>

            <!-- Department Summary Stats -->
            <div class="stats-grid" id="departmentStatsGrid">
                <div class="stat-card">
                    <div class="stat-icon teal">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalDepartments">0</h3>
                        <p>‡πÅ‡∏ú‡∏ô‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon green">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalComplete">0</h3>
                        <p>‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon orange">
                        <i class="fas fa-tools"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalRepair">0</h3>
                        <p>‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon red">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalDamaged">0</h3>
                        <p>‡∏ä‡∏≥‡∏£‡∏∏‡∏î/‡πÄ‡∏™‡∏µ‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    </div>
                </div>
            </div>

            <!-- Department Charts with Status Breakdown -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h2><i class="fas fa-chart-bar"></i> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å</h2>
                    <canvas id="departmentAssetChart"></canvas>
                </div>

                <div class="chart-card">
                    <h2><i class="fas fa-chart-pie"></i> ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</h2>
                    <canvas id="departmentPieChart"></canvas>
                </div>
            </div>

            <!-- Department Detail Cards -->
            <div style="margin-bottom: 20px;">
                <h2 style="color: #333; font-size: 20px; margin-bottom: 20px;">
                    <i class="fas fa-list"></i> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å
                </h2>
            </div>

            <div class="card-grid" id="departmentCardsGrid">
                <!-- Department cards will be generated here -->
            </div>

            <!-- Department Breakdown Table -->
            <div class="table-container" style="margin-top: 30px;">
                <h2 style="margin-bottom: 20px;">
                    <i class="fas fa-table"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                </h2>
                
                <table id="departmentBreakdownTable">
                    <thead>
                        <tr>
                            <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
                            <th style="text-align: center;">‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</th>
                            <th style="text-align: center;">‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°</th>
                            <th style="text-align: center;">‡∏ä‡∏≥‡∏£‡∏∏‡∏î</th>
                            <th style="text-align: center;">‡πÄ‡∏™‡∏µ‡∏¢</th>
                            <th style="text-align: center;">‡∏£‡∏ß‡∏°</th>
                            <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="departmentBreakdownBody">
                        <tr>
                            <td colspan="7" style="text-align: center; color: #aaa; padding: 40px;">
                                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Locations Page -->
        <div id="locations" class="page">
            <div class="header">
                <h1><i class="fas fa-map-marker-alt"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openCapacityModal()">
                        <i class="fas fa-edit"></i>
                        ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏
                    </button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon teal">
                        <i class="fas fa-warehouse"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalLocations">0</h3>
                        <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon cyan">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="avgCapacity">0%</h3>
                        <p>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon green">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalAssetsInLocations">0</h3>
                        <p>‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon orange">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="fullLocations">0</h3>
                        <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡πá‡∏° (>90%)</p>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <h2 style="margin-bottom: 20px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö</h2>
                
                <table>
                    <thead>
                        <tr>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</th>
                            <th>‡πÇ‡∏ã‡∏ô</th>
                            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</th>
                            <th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</th>
                            <th>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="locationsTableBody">
                        <tr>
                            <td colspan="7" style="text-align: center; color: #aaa; padding: 40px;">
                                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Capacity Modal -->
        <div id="capacityModal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">
                    <h2><i class="fas fa-warehouse"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</h2>
                    <button class="close-btn" onclick="closeModal('capacityModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="capacityLocationName">
                    
                    <div class="form-group">
                        <label><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</strong></label>
                        <p id="capacityLocationDisplay" style="color: var(--primary); font-weight: 600;"></p>
                    </div>

                    <div class="form-group">
                        <label><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong></label>
                        <p id="capacityCurrentCount" style="font-size: 24px; color: var(--primary); font-weight: 600;"></p>
                    </div>

                    <div class="form-group">
                        <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (Max Capacity) <span class="required">*</span></label>
                        <input type="number" id="capacityMaxValue" min="1" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î" required>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            <i class="fas fa-info-circle"></i> ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                        </small>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="closeModal('capacityModal')">
                            <i class="fas fa-times"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                        <button class="btn btn-success" onclick="saveCapacity()">
                            <i class="fas fa-check"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Maintenance Page -->
        <div id="maintenance" class="page">
            <div class="header">
                <h1><i class="fas fa-wrench"></i> ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤</h1>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon orange">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="scheduledMaintenance">0</h3>
                        <p>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon cyan">
                        <i class="fas fa-tools"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="inProgressMaintenance">0</h3>
                        <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon green">
                        <i class="fas fa-check-double"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="completedMaintenance">0</h3>
                        <p>‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon teal">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="maintenanceCost">‡∏ø0</h3>
                        <p>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£</p>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <h2 style="margin-bottom: 20px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤</h2>
                
                <table>
                    <thead>
                        <tr>
                            <th>‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</th>
                            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</th>
                            <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</th>
                            <th>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        </tr>
                    </thead>
                    <tbody id="maintenanceTableBody">
                        <tr>
                            <td colspan="5" style="text-align: center; color: #aaa; padding: 40px;">
                                ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Reports Page -->
        <div id="reports" class="page">
            <div class="header">
                <h1><i class="fas fa-chart-line"></i> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="refreshReports()">
                        <i class="fas fa-sync"></i>
                        ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                    </button>
                    <button class="btn btn-warning" onclick="exportToPDF()">
                        <i class="fas fa-file-pdf"></i>
                        Export PDF
                    </button>
                    <button class="btn btn-success" onclick="exportDetailedReport()">
                        <i class="fas fa-file-excel"></i>
                        Export Excel
                    </button>
                </div>
            </div>

            <!-- Filter Section -->
            <div class="table-container" style="margin-bottom: 20px;">
                <h2 style="margin-bottom: 20px;">
                    <i class="fas fa-filter"></i> ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
                </h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                        <input type="date" id="reportStartDate" onchange="updateReportsByDateRange()">
                    </div>
                    <div class="form-group">
                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                        <input type="date" id="reportEndDate" onchange="updateReportsByDateRange()">
                    </div>
                    <div class="form-group">
                        <label>‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡πà‡∏ß‡∏ô</label>
                        <select id="quickDateRange" onchange="applyQuickDateRange()">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</option>
                            <option value="today">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</option>
                            <option value="week">7 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</option>
                            <option value="month">30 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</option>
                            <option value="quarter">3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</option>
                            <option value="year">‡∏õ‡∏µ‡∏ô‡∏µ‡πâ</option>
                            <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏°</label>
                        <select id="reportGroupBy" onchange="updateReportsPage()">
                            <option value="category">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                            <option value="location">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</option>
                            <option value="department">‡πÅ‡∏ú‡∏ô‡∏Å</option>
                            <option value="status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Summary Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon teal">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="reportTotalAssets">0</h3>
                        <p>‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                        <small id="reportAssetChange" style="color: #10b981;"></small>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon green">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="reportTotalValue">‡∏ø0</h3>
                        <p>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                        <small id="reportValueChange" style="color: #10b981;"></small>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon blue">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="reportAvgValue">‡∏ø0</h3>
                        <p>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô</p>
                        <small id="reportAvgChange" style="color: #10b981;"></small>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon orange">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="reportDepreciation">‡∏ø0</h3>
                        <p>‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤ (15%)</p>
                        <small style="color: #666;">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å</small>
                    </div>
                </div>
            </div>

            <!-- Value Breakdown Section -->
            <div style="margin-top: 30px;">
                <h2 style="margin-bottom: 20px;">
                    <i class="fas fa-money-bill-trend-up"></i> ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                </h2>
                
                <div class="charts-grid" style="grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));">
                    <!-- Value by Category -->
                    <div class="chart-card">
                        <h3><i class="fas fa-layer-group"></i> ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h3>
                        <canvas id="valueByCategory"></canvas>
                        <div id="categoryValueTable" style="margin-top: 20px; max-height: 300px; overflow-y: auto;"></div>
                    </div>

                    <!-- Value by Location -->
                    <div class="chart-card">
                        <h3><i class="fas fa-map-marker-alt"></i> ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</h3>
                        <canvas id="valueByLocation"></canvas>
                        <div id="locationValueTable" style="margin-top: 20px; max-height: 300px; overflow-y: auto;"></div>
                    </div>

                    <!-- Value by Department -->
                    <div class="chart-card">
                        <h3><i class="fas fa-building"></i> ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</h3>
                        <canvas id="valueByDepartment"></canvas>
                        <div id="departmentValueTable" style="margin-top: 20px; max-height: 300px; overflow-y: auto;"></div>
                    </div>

                    <!-- Value by Status -->
                    <div class="chart-card">
                        <h3><i class="fas fa-signal"></i> ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</h3>
                        <canvas id="valueByStatus"></canvas>
                        <div id="statusValueTable" style="margin-top: 20px;"></div>
                    </div>
                </div>
            </div>

            <!-- Top Assets -->
            <div style="margin-top: 30px;">
                <div class="table-container">
                    <h2 style="margin-bottom: 20px;">
                        <i class="fas fa-trophy"></i> Top 10 ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
                    </h2>
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 60px;">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                <th>‡∏£‡∏´‡∏±‡∏™</th>
                                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</th>
                                <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
                                <th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ø)</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            </tr>
                        </thead>
                        <tbody id="topAssetsTable">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 40px; color: #aaa;">
                                    ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Quantity Analysis -->
            <div style="margin-top: 30px;">
                <h2 style="margin-bottom: 20px;">
                    <i class="fas fa-chart-bar"></i> ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô
                </h2>
                
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3><i class="fas fa-layer-group"></i> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h3>
                        <canvas id="countByCategory"></canvas>
                    </div>

                    <div class="chart-card">
                        <h3><i class="fas fa-chart-pie"></i> ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</h3>
                        <canvas id="statusPieChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Trend Analysis -->
            <div style="margin-top: 30px;">
                <div class="chart-card">
                    <h2 style="margin-bottom: 20px;">
                        <i class="fas fa-chart-line"></i> ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                    </h2>
                    <canvas id="trendChart" style="max-height: 300px;"></canvas>
                </div>
            </div>

            <!-- Department Holdings by Month -->
            <div style="margin-top: 30px;">
                <h2 style="margin-bottom: 20px;">
                    <i class="fas fa-building"></i> ‡∏Å‡∏≤‡∏£‡∏ñ‡∏∑‡∏≠‡∏Ñ‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å
                </h2>
                
                <div class="charts-grid">
                    <!-- Value by Department per Month -->
                    <div class="chart-card">
                        <h3><i class="fas fa-dollar-sign"></i> ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ñ‡∏∑‡∏≠‡∏Ñ‡∏£‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡πÅ‡∏¢‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å)</h3>
                        <canvas id="departmentValueTrendChart" style="max-height: 350px;"></canvas>
                        <div style="margin-top: 15px;">
                            <small style="color: #666;">
                                <i class="fas fa-info-circle"></i> 
                                ‡πÅ‡∏™‡∏î‡∏á‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
                            </small>
                        </div>
                    </div>

                    <!-- Quantity by Department per Month -->
                    <div class="chart-card">
                        <h3><i class="fas fa-boxes"></i> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ñ‡∏∑‡∏≠‡∏Ñ‡∏£‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡πÅ‡∏¢‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å)</h3>
                        <canvas id="departmentCountTrendChart" style="max-height: 350px;"></canvas>
                        <div style="margin-top: 15px;">
                            <small style="color: #666;">
                                <i class="fas fa-info-circle"></i> 
                                ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏™‡∏∞‡∏™‡∏°‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Statistics Table -->
            <div style="margin-top: 30px;">
                <div class="table-container">
                    <h2 style="margin-bottom: 20px;">
                        <i class="fas fa-table"></i> ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                    </h2>
                    
                    <div style="overflow-x: auto;">
                        <table id="detailedStatsTable">
                            <thead>
                                <tr>
                                    <th>‡∏Å‡∏•‡∏∏‡πà‡∏°</th>
                                    <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                    <th>%</th>
                                    <th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°</th>
                                    <th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</th>
                                    <th>‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</th>
                                    <th>‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</th>
                                    <th>‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</th>
                                    <th>‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°</th>
                                    <th>‡∏ä‡∏≥‡∏£‡∏∏‡∏î</th>
                                    <th>‡πÄ‡∏™‡∏µ‡∏¢</th>
                                </tr>
                            </thead>
                            <tbody id="detailedStatsBody">
                                <tr>
                                    <td colspan="11" style="text-align: center; padding: 40px; color: #aaa;">
                                        ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Summary Report -->
            <div style="margin-top: 30px;">
                <div class="table-container" style="background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%); border-left: 4px solid var(--primary);">
                    <h2 style="margin-bottom: 20px; color: var(--primary);">
                        <i class="fas fa-file-alt"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                    </h2>
                    <div id="summaryReport" style="line-height: 2;">
                        <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings" class="page">
            <div class="header">
                <h1><i class="fas fa-cog"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h1>
                <div class="header-actions">
                    <button class="btn btn-success" onclick="saveSettings()">
                        <i class="fas fa-save"></i>
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
                    </button>
                </div>
            </div>

            <div class="table-container">
                <h2 style="margin-bottom: 25px;">
                    <i class="fas fa-database"></i> ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets
                </h2>
                
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label>Google Apps Script Web App URL <span class="required">*</span></label>
                        <input type="text" id="webAppUrl" placeholder="https://script.google.com/macros/s/...">
                        <small style="color: #666; margin-top: 5px; display: block;">
                            <i class="fas fa-info-circle"></i> 
                            Deploy Apps Script ‡πÅ‡∏•‡πâ‡∏ß copy Web app URL ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                        </small>
                    </div>

                    <div class="form-group">
                        <label>Sheet Name (Tab)</label>
                        <input type="text" id="sheetName" value="Assets" placeholder="Assets">
                    </div>

                    <div class="form-group">
                        <button class="btn btn-primary" onclick="testConnection()" style="margin-top: 28px; width: 100%;">
                            <i class="fas fa-plug"></i>
                            ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                        </button>
                    </div>
                </div>

                <div id="connectionResult" style="display: none; margin-top: 20px; padding: 15px; border-radius: 8px;">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                    <button class="btn btn-success" onclick="initializeGoogleSheets()">
                        <i class="fas fa-table"></i>
                        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å)
                    </button>
                    <button class="btn btn-info" onclick="loadFromGoogleSheets()">
                        <i class="fas fa-sync"></i>
                        ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Sheets
                    </button>
                </div>
            </div>

            <div style="height: 30px;"></div>

            <div class="table-container">
                <h2 style="margin-bottom: 25px;">
                    <i class="fas fa-building"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
                </h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</label>
                        <input type="text" id="companyName" value="‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó FMCG ‡∏à‡∏≥‡∏Å‡∏±‡∏î">
                    </div>
                    
                    <div class="form-group">
                        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à</label>
                        <input type="text" value="FMCG / ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏∏‡∏õ‡πÇ‡∏†‡∏Ñ‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ">
                    </div>
                    
                    <div class="form-group">
                        <label>‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                        <input type="tel" value="02-123-4567">
                    </div>
                    
                    <div class="form-group">
                        <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                        <input type="email" value="info@fmcg.com">
                    </div>

                    <div class="form-group full-width">
                        <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
                        <textarea>123 ‡∏ñ‡∏ô‡∏ô‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏° 9 ‡πÅ‡∏Ç‡∏ß‡∏á‡∏´‡πâ‡∏ß‡∏¢‡∏Ç‡∏ß‡∏≤‡∏á ‡πÄ‡∏Ç‡∏ï‡∏´‡πâ‡∏ß‡∏¢‡∏Ç‡∏ß‡∏≤‡∏á ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø 10310</textarea>
                    </div>
                </div>
            </div>

            <div style="height: 30px;"></div>

            <div class="form-actions">
                <button class="btn btn-success" onclick="saveSettings()">
                    <i class="fas fa-save"></i>
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qrModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2><i class="fas fa-qrcode"></i> QR Code - ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</h2>
                <button class="close-btn" onclick="closeModal('qrModal')">&times;</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <h3 id="qrAssetName" style="color: var(--primary); margin-bottom: 10px;"></h3>
                <p id="qrAssetCode" style="color: #666; margin-bottom: 20px;"></p>
                <div id="qrcodeContainer" style="display: flex; justify-content: center; margin: 20px 0;"></div>
                <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="downloadQRCode()">
                        <i class="fas fa-download"></i> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î QR Code
                    </button>
                    <button class="btn btn-info" onclick="printQRCode()">
                        <i class="fas fa-print"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå QR Code
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transfer Asset Modal -->
    <div id="transferModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2><i class="fas fa-exchange-alt"></i> ‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</h2>
                <button class="close-btn" onclick="closeModal('transferModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="transferAssetId">
                
                <div class="form-group">
                    <label><strong>‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô:</strong></label>
                    <p id="transferAssetInfo" style="color: var(--primary); font-weight: 600;"></p>
                </div>

                <div class="form-group">
                    <label><strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong></label>
                    <div style="background: #f0f9f9; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <p><i class="fas fa-map-marker-alt"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: <span id="currentLocation"></span></p>
                        <p><i class="fas fa-building"></i> ‡πÅ‡∏ú‡∏ô‡∏Å: <span id="currentDepartment"></span></p>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà <span class="required">*</span></label>
                        <input type="text" id="newLocation" list="locationList" placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà" required>
                        <datalist id="locationList"></datalist>
                    </div>

                    <div class="form-group">
                        <label>‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡πÅ‡∏ú‡∏ô‡∏Å <span class="required">*</span></label>
                        <input type="text" id="newDepartment" list="departmentList" placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏ú‡∏ô‡∏Å‡πÉ‡∏´‡∏°‡πà" required>
                        <datalist id="departmentList"></datalist>
                    </div>
                </div>

                <div class="form-group">
                    <label>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢ <span class="required">*</span></label>
                    <textarea id="transferReason" rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•..." required></textarea>
                </div>

                <div class="form-group">
                    <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                    <textarea id="transferNote" rows="2" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
                </div>

                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="closeModal('transferModal')">
                        <i class="fas fa-times"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                    <button class="btn btn-success" onclick="confirmTransfer()">
                        <i class="fas fa-check"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
    </div>

        <script>
        // ‚ö†Ô∏è Critical Functions - ‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö onclick events
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            if (sidebar) sidebar.classList.toggle('collapsed');
        }

        function showPage(pageId) {
            // ‡∏£‡∏≠ DOM ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    showPage(pageId);
                });
                return;
            }
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            const targetPage = document.getElementById(pageId);
            if (targetPage) targetPage.classList.add('active');
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï active menu
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => item.classList.remove('active'));
            
            const activeMenu = Array.from(menuItems).find(item => 
                item.getAttribute('onclick') === "showPage('" + pageId + "')"
            );
            if (activeMenu) activeMenu.classList.add('active');
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤
            setTimeout(function() {
                if (pageId === 'dashboard') {
                    if (typeof initDashboardCharts === 'function') initDashboardCharts();
                    if (typeof updateDashboard === 'function') updateDashboard();
                } else if (pageId === 'reports') {
                    if (typeof initReportCharts === 'function') initReportCharts();
                    if (typeof updateReportsPage === 'function') updateReportsPage();
                } else if (pageId === 'assets') {
                    if (typeof renderAssetsTable === 'function') renderAssetsTable();
                } else if (pageId === 'departments') {
                    if (typeof updateDepartmentPage === 'function') updateDepartmentPage();
                } else if (pageId === 'locations') {
                    if (typeof updateLocationsPage === 'function') updateLocationsPage();
                } else if (pageId === 'maintenance') {
                    if (typeof updateMaintenancePage === 'function') updateMaintenancePage();
                }
            }, 100);
        }

        // Global Variables
        let assetsData = [];
        let importData = [];
        
        // ========================================
        // ‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script URL
        // ========================================
        // üî• ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Apps Script ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà
        // 
        // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£:
        // 1. Deploy Google Apps Script ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        // 2. Copy Web App URL
        // 3. ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà URL ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzcSH7cQ3kYiSvMkj49uounseXuUAwH6q2iFS85fZFV8FcwoC0X5ojPOJpRNt1PAuge/exec';
        
        // ========================================
        // ‚ö° Google Sheets API (‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ - ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥!)
        // ========================================
        // ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ: ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ Apps Script ‡∏°‡∏≤‡∏Å
        // ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î: ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ Apps Script)
        // 
        // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤:
        // 1. ‡πÄ‡∏õ‡∏¥‡∏î Google Cloud Console
        // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á API Key ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Sheets API
        // 3. ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ
        const USE_SHEETS_API = true; // ‚≠ê ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Sheets API (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
        const SHEETS_API_KEY = 'AIzaSyCbId0_NCsmI84pl3vRJdqokZRHoMWHmCM'; // üîë API Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        const SPREADSHEET_ID = '1o_Wpre0DNfh5XNIEiWR-8uI3zCDaYxCysI5utuDDkBI'; // üìä Spreadsheet ID
        const SHEET_NAME = 'Assets'; // üìù ‡∏ä‡∏∑‡πà‡∏≠ Tab ‡πÉ‡∏ô Sheets
        
        let sheetsConfig = {
            webAppUrl: GOOGLE_APPS_SCRIPT_URL,
            sheetName: 'Assets'
        };

        // Toggle Sidebar
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        // Page Navigation
        function showPage(pageId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            
            document.getElementById(pageId).classList.add('active');
            
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => item.classList.remove('active'));
            
            const clickedMenu = Array.from(menuItems).find(item => {
                return item.getAttribute('onclick') === `showPage('${pageId}')`;
            });
            if (clickedMenu) {
                clickedMenu.classList.add('active');
            }
            
            if (pageId === 'dashboard') {
                setTimeout(initDashboardCharts, 100);
                updateDashboard();
            }
            if (pageId === 'reports') {
                setTimeout(initReportCharts, 100);
                updateReportsPage();
            }
            if (pageId === 'assets') {
                renderAssetsTable();
            }
            if (pageId === 'departments') {
                updateDepartmentPage();
            }
            if (pageId === 'locations') {
                updateLocationsPage();
            }
            if (pageId === 'maintenance') {
                updateMaintenancePage();
            }
        }

        // Initialize Dashboard Charts
        function initDashboardCharts() {
            // Category Chart
            const categoryCtx = document.getElementById('categoryChart');
            if (categoryCtx) {
                if (categoryCtx.chart) {
                    categoryCtx.chart.destroy();
                }

                const categoryData = {};
                assetsData.forEach(asset => {
                    categoryData[asset.category] = (categoryData[asset.category] || 0) + 1;
                });

                const categories = Object.keys(categoryData);
                const counts = Object.values(categoryData);

                categoryCtx.chart = new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: categories.length > 0 ? categories : ['‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'],
                        datasets: [{
                            data: counts.length > 0 ? counts : [1],
                            backgroundColor: [
                                '#14b8a6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444',
                                '#8b5cf6', '#ec4899', '#f97316', '#6366f1', '#84cc16'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // Status Chart
            const statusCtx = document.getElementById('statusDashChart');
            if (statusCtx) {
                if (statusCtx.chart) {
                    statusCtx.chart.destroy();
                }

                const statusData = {
                    '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå': 0,
                    '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°': 0,
                    '‡∏ä‡∏≥‡∏£‡∏∏‡∏î': 0,
                    '‡πÄ‡∏™‡∏µ‡∏¢': 0
                };

                assetsData.forEach(asset => {
                    if (statusData[asset.status] !== undefined) {
                        statusData[asset.status]++;
                    }
                });

                statusCtx.chart = new Chart(statusCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(statusData),
                        datasets: [{
                            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô',
                            data: Object.values(statusData),
                            backgroundColor: ['#10b981', '#f59e0b', '#fb923c', '#ef4444']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }
        }

        // Initialize Report Charts
        function initReportCharts() {
            // Asset Count Chart
            const assetCountCtx = document.getElementById('assetCountChart');
            if (assetCountCtx) {
                if (assetCountCtx.chart) {
                    assetCountCtx.chart.destroy();
                }

                const categoryData = {};
                assetsData.forEach(asset => {
                    categoryData[asset.category] = (categoryData[asset.category] || 0) + 1;
                });

                const categories = Object.keys(categoryData);
                const counts = Object.values(categoryData);

                assetCountCtx.chart = new Chart(assetCountCtx, {
                    type: 'bar',
                    data: {
                        labels: categories.length > 0 ? categories : ['‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'],
                        datasets: [{
                            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏´‡∏ô‡πà‡∏ß‡∏¢)',
                            data: counts.length > 0 ? counts : [0],
                            backgroundColor: [
                                '#14b8a6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444',
                                '#8b5cf6', '#ec4899', '#f97316', '#6366f1', '#84cc16'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }

            // Status Chart
            const statusCtx = document.getElementById('statusChart');
            if (statusCtx) {
                if (statusCtx.chart) {
                    statusCtx.chart.destroy();
                }

                const statusData = {
                    '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå': 0,
                    '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°': 0,
                    '‡∏ä‡∏≥‡∏£‡∏∏‡∏î': 0,
                    '‡πÄ‡∏™‡∏µ‡∏¢': 0
                };

                assetsData.forEach(asset => {
                    if (statusData[asset.status] !== undefined) {
                        statusData[asset.status]++;
                    }
                });

                statusCtx.chart = new Chart(statusCtx, {
                    type: 'pie',
                    data: {
                        labels: Object.keys(statusData),
                        datasets: [{
                            data: Object.values(statusData),
                            backgroundColor: ['#10b981', '#f59e0b', '#fb923c', '#ef4444']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        // Update Dashboard
        function updateDashboard() {
            document.getElementById('totalAssets').textContent = assetsData.length;
            
            const complete = assetsData.filter(a => a.status === '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå').length;
            const repair = assetsData.filter(a => a.status === '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°').length;
            const damaged = assetsData.filter(a => a.status === '‡∏ä‡∏≥‡∏£‡∏∏‡∏î' || a.status === '‡πÄ‡∏™‡∏µ‡∏¢').length;
            
            document.getElementById('availableAssets').textContent = complete;
            document.getElementById('inUseAssets').textContent = repair;
            document.getElementById('maintenanceAssets').textContent = damaged;
            
            renderRecentAssets();

            // Update charts with new data
            if (assetsData.length > 0) {
                const categoryCtx = document.getElementById('categoryChart');
                if (categoryCtx && categoryCtx.chart) {
                    categoryCtx.chart.destroy();
                    categoryCtx.chart = null;
                }

                const statusCtx = document.getElementById('statusDashChart');
                if (statusCtx && statusCtx.chart) {
                    statusCtx.chart.destroy();
                    statusCtx.chart = null;
                }

                initDashboardCharts();
            }
        }

        // Render Recent Assets
        function renderRecentAssets() {
            const tbody = document.getElementById('recentAssetsTable');
            
            if (assetsData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; color: #aaa; padding: 40px;">
                            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠ Import Excel
                        </td>
                    </tr>
                `;
                return;
            }
            
            const recent = assetsData.slice(-5).reverse();
            tbody.innerHTML = recent.map(asset => `
                <tr>
                    <td>${asset.code}</td>
                    <td>${asset.name}</td>
                    <td>${asset.category}</td>
                    <td><span class="badge ${getStatusClass(asset.status)}">${asset.status}</span></td>
                    <td>${Number(asset.price).toLocaleString()}</td>
                </tr>
            `).join('');
        }

        // Render Assets Table
        function renderAssetsTable() {
            const tbody = document.getElementById('assetsTableBody');
            document.getElementById('assetCount').textContent = assetsData.length;
            
            if (assetsData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; color: #aaa; padding: 40px;">
                            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠ Import Excel
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = assetsData.map((asset, index) => `
                <tr>
                    <td>${asset.code}</td>
                    <td>${asset.name}</td>
                    <td>${asset.category}</td>
                    <td>${asset.location}</td>
                    <td>${asset.department || '-'}</td>
                    <td><span class="badge ${getStatusClass(asset.status)}">${asset.status}</span></td>
                    <td>${Number(asset.price).toLocaleString()}</td>
                    <td style="white-space: nowrap;">
                        <button class="action-btn view" onclick="showQRCode(${index})" title="QR Code">
                            <i class="fas fa-qrcode"></i>
                        </button>
                        <button class="action-btn primary" onclick="showTransferModal(${index})" title="‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢">
                            <i class="fas fa-exchange-alt"></i>
                        </button>
                        <button class="action-btn edit" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" onclick="deleteAsset('${asset.code}')" title="‡∏•‡∏ö">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Filter Assets
        function filterAssets() {
            const search = document.getElementById('searchAsset').value.toLowerCase();
            const category = document.getElementById('filterCategory').value;
            const status = document.getElementById('filterStatus').value;
            
            const tbody = document.getElementById('assetsTableBody');
            const rows = tbody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const categoryMatch = !category || text.includes(category.toLowerCase());
                const statusMatch = !status || text.includes(status.toLowerCase());
                const searchMatch = !search || text.includes(search);
                
                row.style.display = (categoryMatch && statusMatch && searchMatch) ? '' : 'none';
            });
        }

        // Get Status Class
        function getStatusClass(status) {
            const classes = {
                '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå': 'complete',
                '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°': 'repair',
                '‡∏ä‡∏≥‡∏£‡∏∏‡∏î': 'damaged',
                '‡πÄ‡∏™‡∏µ‡∏¢': 'broken',
                // Legacy support
                '‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô': 'available',
                '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô': 'in-use',
                '‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á': 'maintenance',
                '‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô': 'retired'
            };
            return classes[status] || 'available';
        }

        // Save New Asset
        async function saveNewAsset() {
            const code = document.getElementById('newAssetCode').value;
            const name = document.getElementById('newAssetName').value;
            const category = document.getElementById('newCategory').value;
            const brand = document.getElementById('newBrand').value;
            const model = document.getElementById('newModel').value;
            const serial = document.getElementById('newSerial').value;
            const purchaseDate = document.getElementById('newPurchaseDate').value;
            const price = document.getElementById('newPrice').value;
            const location = document.getElementById('newLocation').value;
            const department = document.getElementById('newDepartment').value;
            const status = document.getElementById('newStatus').value;
            const description = document.getElementById('newDescription').value;
            
            if (!code || !name || !category || !purchaseDate || !price || !location) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô (*)', 'error');
                return;
            }
            
            const asset = {
                code, name, category, brand, model, serial,
                purchaseDate, price, location, department, status, description,
                createdAt: new Date().toISOString()
            };
            
            showLoading();
            
            try {
                // Save to local storage
                assetsData.push(asset);
                localStorage.setItem('fmcgAssets', JSON.stringify(assetsData));
                
                // Save to Google Sheets if configured
                if (sheetsConfig.webAppUrl) {
                    await saveToGoogleSheets([asset]);
                }
                
                hideLoading();
                showNotification('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                
                // Clear form
                document.getElementById('newAssetCode').value = '';
                document.getElementById('newAssetName').value = '';
                document.getElementById('newBrand').value = '';
                document.getElementById('newModel').value = '';
                document.getElementById('newSerial').value = '';
                document.getElementById('newDescription').value = '';
                
                updateDashboard();
                showPage('assets');
            } catch (error) {
                hideLoading();
                showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
            }
        }

        // Delete Asset
        function deleteAsset(code) {
            if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô ' + code + ' ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                return;
            }
            
            assetsData = assetsData.filter(a => a.code !== code);
            localStorage.setItem('fmcgAssets', JSON.stringify(assetsData));
            
            showNotification('‚úÖ ‡∏•‡∏ö‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            renderAssetsTable();
            updateDashboard();
        }

        // ========================================
        // üî∑ QR Code Functions
        // ========================================
        let currentQRAsset = null;

        function showQRCode(index) {
            currentQRAsset = assetsData[index];
            
            document.getElementById('qrAssetName').textContent = currentQRAsset.name;
            document.getElementById('qrAssetCode').textContent = `‡∏£‡∏´‡∏±‡∏™: ${currentQRAsset.code}`;
            
            // ‡∏•‡πâ‡∏≤‡∏á QR Code ‡πÄ‡∏Å‡πà‡∏≤
            const container = document.getElementById('qrcodeContainer');
            container.innerHTML = '';
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡πÉ‡∏´‡∏°‡πà
            const qrData = JSON.stringify({
                code: currentQRAsset.code,
                name: currentQRAsset.name,
                category: currentQRAsset.category,
                location: currentQRAsset.location,
                department: currentQRAsset.department,
                status: currentQRAsset.status
            });
            
            new QRCode(container, {
                text: qrData,
                width: 256,
                height: 256,
                colorDark: "#14b8a6",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            
            openModal('qrModal');
        }

        function downloadQRCode() {
            if (!currentQRAsset) return;
            
            const canvas = document.querySelector('#qrcodeContainer canvas');
            if (!canvas) {
                showNotification('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö QR Code', 'error');
                return;
            }
            
            const link = document.createElement('a');
            link.download = `QR_${currentQRAsset.code}.png`;
            link.href = canvas.toDataURL();
            link.click();
            
            showNotification('‚úÖ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î QR Code ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        function printQRCode() {
            if (!currentQRAsset) return;
            
            const printWindow = window.open('', '', 'width=600,height=600');
            const canvas = document.querySelector('#qrcodeContainer canvas');
            
            if (!canvas) {
                showNotification('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö QR Code', 'error');
                return;
            }
            
            printWindow.document.write(`
                <html>
                <head>
                    <title>‡∏û‡∏¥‡∏°‡∏û‡πå QR Code - ${currentQRAsset.code}</title>
                    <style>
                        body { 
                            font-family: 'Prompt', sans-serif; 
                            text-align: center; 
                            padding: 50px;
                        }
                        h2 { color: #14b8a6; margin-bottom: 10px; }
                        p { color: #666; margin-bottom: 20px; }
                        img { border: 2px solid #14b8a6; padding: 10px; }
                    </style>
                </head>
                <body>
                    <h2>${currentQRAsset.name}</h2>
                    <p>‡∏£‡∏´‡∏±‡∏™: ${currentQRAsset.code}</p>
                    <img src="${canvas.toDataURL()}" />
                    <p style="margin-top: 20px;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: ${currentQRAsset.location}</p>
                    <p>‡πÅ‡∏ú‡∏ô‡∏Å: ${currentQRAsset.department || '-'}</p>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 250);
        }

        // ========================================
        // üîÑ Transfer Functions
        // ========================================
        let transferHistory = JSON.parse(localStorage.getItem('fmcgTransferHistory') || '[]');

        function showTransferModal(index) {
            const asset = assetsData[index];
            
            document.getElementById('transferAssetId').value = index;
            document.getElementById('transferAssetInfo').textContent = `${asset.code} - ${asset.name}`;
            document.getElementById('currentLocation').textContent = asset.location || '-';
            document.getElementById('currentDepartment').textContent = asset.department || '-';
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('newLocation').value = '';
            document.getElementById('newDepartment').value = '';
            document.getElementById('transferReason').value = '';
            document.getElementById('transferNote').value = '';
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á datalist ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö locations ‡πÅ‡∏•‡∏∞ departments
            populateDatalist();
            
            openModal('transferModal');
        }

        function populateDatalist() {
            // Locations
            const locations = [...new Set(assetsData.map(a => a.location).filter(Boolean))];
            const locationList = document.getElementById('locationList');
            locationList.innerHTML = locations.map(loc => `<option value="${loc}">`).join('');
            
            // Departments
            const departments = [...new Set(assetsData.map(a => a.department).filter(Boolean))];
            const departmentList = document.getElementById('departmentList');
            departmentList.innerHTML = departments.map(dept => `<option value="${dept}">`).join('');
        }

        function confirmTransfer() {
            const index = parseInt(document.getElementById('transferAssetId').value);
            const newLocation = document.getElementById('newLocation').value.trim();
            const newDepartment = document.getElementById('newDepartment').value.trim();
            const reason = document.getElementById('transferReason').value.trim();
            const note = document.getElementById('transferNote').value.trim();
            
            if (!newLocation || !newDepartment || !reason) {
                showNotification('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'warning');
                return;
            }
            
            const asset = assetsData[index];
            const oldLocation = asset.location;
            const oldDepartment = asset.department;
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢
            const transfer = {
                assetCode: asset.code,
                assetName: asset.name,
                fromLocation: oldLocation,
                toLocation: newLocation,
                fromDepartment: oldDepartment,
                toDepartment: newDepartment,
                reason: reason,
                note: note,
                transferDate: new Date().toISOString(),
                transferBy: 'Admin' // TODO: ‡πÄ‡∏û‡∏¥‡πà‡∏° user authentication
            };
            
            transferHistory.unshift(transfer);
            localStorage.setItem('fmcgTransferHistory', JSON.stringify(transferHistory));
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô
            assetsData[index].location = newLocation;
            assetsData[index].department = newDepartment;
            localStorage.setItem('fmcgAssets', JSON.stringify(assetsData));
            
            closeModal('transferModal');
            showNotification('‚úÖ ‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            
            renderAssetsTable();
            updateDashboard();
            updateDepartmentPage();
            updateLocationsPage();
        }

        // ========================================
        // üìä Import Excel Functions
        // ========================================
        function showImportSection() {
            document.getElementById('importSection').style.display = 'block';
            document.getElementById('importSection').scrollIntoView({ behavior: 'smooth' });
        }

        function hideImportSection() {
            document.getElementById('importSection').style.display = 'none';
        }

        function processExcelFile() {
            const fileInput = document.getElementById('excelFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel', 'warning');
                return;
            }
            
            showLoading();
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    if (jsonData.length === 0) {
                        throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå');
                    }
                    
                    // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
                    let addedCount = 0;
                    let skippedCount = 0;
                    
                    jsonData.forEach(row => {
                        const code = row['‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô'] || row['code'] || '';
                        const name = row['‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô'] || row['name'] || '';
                        
                        if (!code || !name) {
                            skippedCount++;
                            return;
                        }
                        
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™‡∏ã‡πâ‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                        if (assetsData.find(a => a.code === code)) {
                            skippedCount++;
                            return;
                        }
                        
                        const newAsset = {
                            code: code,
                            name: name,
                            category: row['‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà'] || row['category'] || '',
                            brand: row['‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠'] || row['brand'] || '',
                            model: row['‡∏£‡∏∏‡πà‡∏ô'] || row['model'] || '',
                            serial: row['Serial Number'] || row['serial'] || '',
                            purchaseDate: row['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠'] || row['purchaseDate'] || '',
                            price: parseFloat(row['‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠'] || row['price'] || 0),
                            location: row['‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö'] || row['location'] || '',
                            department: row['‡πÅ‡∏ú‡∏ô‡∏Å'] || row['department'] || '',
                            status: row['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] || row['status'] || '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå',
                            description: row['‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢'] || row['description'] || '',
                            createdAt: new Date().toISOString()
                        };
                        
                        assetsData.push(newAsset);
                        addedCount++;
                    });
                    
                    localStorage.setItem('fmcgAssets', JSON.stringify(assetsData));
                    
                    hideLoading();
                    hideImportSection();
                    
                    showNotification(`‚úÖ Import ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÄ‡∏û‡∏¥‡πà‡∏° ${addedCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£${skippedCount > 0 ? `, ‡∏Ç‡πâ‡∏≤‡∏° ${skippedCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£` : ''}`, 'success');
                    
                    renderAssetsTable();
                    updateDashboard();
                    fileInput.value = '';
                    
                } catch (error) {
                    hideLoading();
                    showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        // ========================================
        // üéØ Modal Functions
        // ========================================
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Download Template
        function downloadTemplate() {
            const template = [
                ['‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô', '‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô', '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', '‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠', '‡∏£‡∏∏‡πà‡∏ô', 'Serial Number', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠', '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö', '‡πÅ‡∏ú‡∏ô‡∏Å', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', '‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢'],
                ['CUT-001', 'Cutter Safety ‡∏°‡∏µ‡∏î‡∏Ñ‡∏±‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡πå', 'Cutter Safety', 'Safety Plus', 'SP-100', 'CUT001', '2024-01-15', '85', '‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - ‡πÇ‡∏ã‡∏ô A', 'AC', '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå', '‡∏°‡∏µ‡∏î‡∏Ñ‡∏±‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÉ‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏¥‡∏£‡∏†‡∏±‡∏¢'],
                ['GRD-001', '‡∏ï‡∏∞‡πÅ‡∏Å‡∏£‡∏á‡∏Å‡∏£‡∏á ‡∏ï‡∏∞‡πÅ‡∏Å‡∏£‡∏á‡πÄ‡∏´‡∏•‡πá‡∏Å', '‡∏ï‡∏∞‡πÅ‡∏Å‡∏£‡∏á‡∏Å‡∏£‡∏á', 'Metal Grid', 'MG-1000', 'GRD001', '2023-06-10', '2500', '‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - ‡πÇ‡∏ã‡∏ô A', 'AP', '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå', '‡∏ï‡∏∞‡πÅ‡∏Å‡∏£‡∏á‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏û‡∏±‡∏ö‡πÑ‡∏î‡πâ ‡∏Ç‡∏ô‡∏≤‡∏î 100x80 ‡∏ã‡∏°.'],
                ['RF-001', 'RF Scanner ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡πÅ‡∏Å‡∏ô', 'RF Scanner', 'Zebra', 'MC3300', 'RF001', '2023-08-15', '35000', '‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - ‡πÇ‡∏ã‡∏ô B', 'APB', '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡πÅ‡∏Å‡∏ô RF ‡∏û‡∏£‡πâ‡∏≠‡∏° WiFi ‡πÅ‡∏•‡∏∞ Bluetooth'],
                ['IDT-001', 'IData Mobile Computer', 'IData', 'IData', '95W', 'IDT001', '2024-01-10', '28000', '‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - ‡πÇ‡∏ã‡∏ô C', 'CF', '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á Mobile Computer Android ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î'],
                ['BATRF-001', '‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà RF Scanner', '‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà RF', 'Zebra', 'MC3300-BAT', 'BAT001', '2023-08-15', '4500', '‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - ‡πÇ‡∏ã‡∏ô A', 'APL', '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå', '‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö RF Scanner ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏ 7000mAh'],
                ['BATID-001', '‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà IData', '‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà IData', 'IData', '95W-BAT', 'BIDX001', '2024-01-10', '3800', '‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - ‡πÇ‡∏ã‡∏ô B', 'CP', '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå', '‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö IData ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏ 6000mAh'],
                ['RAD-001', '‡∏ß‡∏¥‡∏ó‡∏¢‡∏∏‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ Walkie Talkie', '‡∏ß‡∏¥‡∏ó‡∏¢‡∏∏‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£', 'Motorola', 'GP328', 'RAD001', '2023-05-20', '8500', '‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - ‡πÇ‡∏ã‡∏ô C', 'DP', '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå', '‡∏ß‡∏¥‡∏ó‡∏¢‡∏∏‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ UHF ‡∏£‡∏∞‡∏¢‡∏∞ 5 ‡∏Å‡∏°.'],
                ['PLT-001', '‡∏û‡∏≤‡πÄ‡∏•‡∏ó‡πÑ‡∏°‡πâ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô', '‡∏û‡∏≤‡πÄ‡∏•‡∏ó', 'Standard', 'PT-1200', 'PLT001', '2024-01-15', '1500', '‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - ‡πÇ‡∏ã‡∏ô A', 'INV', '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå', '‡∏û‡∏≤‡πÄ‡∏•‡∏ó‡πÑ‡∏°‡πâ‡∏Ç‡∏ô‡∏≤‡∏î 120x100 ‡∏ã‡∏°.'],
                ['TOT-001', 'TOTE ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å', 'TOTE', 'Tote Box', 'TB-604025', 'TOT001', '2023-12-10', '850', '‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - ‡πÇ‡∏ã‡∏ô B', 'LS', '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå', '‡∏Å‡∏•‡πà‡∏≠‡∏á TOTE ‡∏Ç‡∏ô‡∏≤‡∏î 60x40x25 ‡∏ã‡∏°. ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô']
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(template);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Template');
            
            // Set column widths
            ws['!cols'] = [
                {wch: 15}, {wch: 30}, {wch: 18}, {wch: 15}, 
                {wch: 15}, {wch: 15}, {wch: 12}, {wch: 12}, 
                {wch: 25}, {wch: 10}, {wch: 12}, {wch: 40}
            ];
            
            XLSX.writeFile(wb, 'Warehouse_Asset_Import_Template.xlsx');
            showNotification('‚úÖ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Template ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        // Handle File Upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            showLoading();
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {
                        type: 'array',
                        cellDates: true,
                        dateNF: 'yyyy-mm-dd',
                        raw: false
                    });
                    
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, {
                        defval: '' // ‡∏Ñ‡πà‡∏≤ default ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö cell ‡∏ß‡πà‡∏≤‡∏á
                    });
                    
                    console.log('Raw data from Excel:', jsonData);
                    
                    importData = jsonData.map((row, index) => {
                        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                        let purchaseDate = '';
                        const dateValue = row['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠'] || row['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà'];
                        if (dateValue) {
                            if (typeof dateValue === 'number') {
                                const excelDate = new Date((dateValue - 25569) * 86400 * 1000);
                                purchaseDate = excelDate.toISOString().split('T')[0];
                            } else if (dateValue.includes('-')) {
                                purchaseDate = dateValue;
                            } else if (dateValue.includes('/')) {
                                const parts = dateValue.split('/');
                                if (parts.length === 3) {
                                    purchaseDate = `${parts[2]}-${parts[1].padStart(2,'0')}-${parts[0].padStart(2,'0')}`;
                                }
                            }
                        }
                        
                        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏Ñ‡∏≤ - ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà 0
                        let price = 0;
                        const priceValue = row['‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠'] || row['‡∏£‡∏≤‡∏Ñ‡∏≤'] || row['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤'];
                        if (priceValue) {
                            price = parseFloat(String(priceValue).replace(/[^0-9.-]/g, '')) || 0;
                        }
                        
                        const asset = {
                            code: row['‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô'] || row['‡∏£‡∏´‡∏±‡∏™'] || '',
                            name: row['‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô'] || row['‡∏ä‡∏∑‡πà‡∏≠'] || '',
                            category: row['‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà'] || row['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó'] || '',
                            brand: row['‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠'] || row['‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå'] || '',
                            model: row['‡∏£‡∏∏‡πà‡∏ô'] || '',
                            serial: row['Serial Number'] || row['‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ã‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏•'] || row['Serial'] || '',
                            purchaseDate: purchaseDate,
                            price: price,
                            location: row['‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö'] || row['‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà'] || '',
                            department: row['‡πÅ‡∏ú‡∏ô‡∏Å'] || '',
                            status: row['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] || '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå',
                            description: row['‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢'] || row['‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏'] || '',
                            createdAt: new Date().toISOString()
                        };
                        
                        console.log(`Row ${index + 1}:`, asset);
                        return asset;
                    });
                    
                    // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
                    importData = importData.filter(asset => {
                        return asset.code || asset.name; // ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠
                    });
                    
                    hideLoading();
                    
                    if (importData.length === 0) {
                        showNotification('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå', 'warning');
                        return;
                    }
                    
                    showPreview();
                    showNotification(`‚úÖ ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ö ${importData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, 'success');
                    
                } catch (error) {
                    hideLoading();
                    console.error('Import error:', error);
                    showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Show Preview
        function showPreview() {
            document.getElementById('previewSection').style.display = 'block';
            const tbody = document.getElementById('previewTableBody');
            
            tbody.innerHTML = importData.map(asset => `
                <tr>
                    <td>${asset.code}</td>
                    <td>${asset.name}</td>
                    <td>${asset.category}</td>
                    <td>${asset.location}</td>
                    <td>${asset.department || '-'}</td>
                    <td>${Number(asset.price).toLocaleString()}</td>
                    <td><span class="badge ${getStatusClass(asset.status)}">${asset.status}</span></td>
                </tr>
            `).join('');
        }

        // Confirm Import
        async function confirmImport() {
            if (importData.length === 0) {
                showNotification('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤', 'warning');
                return;
            }
            
            showLoading();
            
            try {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î
                const processedData = importData.map(asset => {
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà 0
                    if (!asset.price || asset.price === '') {
                        asset.price = 0;
                    }
                    
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà "‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå"
                    if (!asset.status) {
                        asset.status = '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå';
                    }
                    
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà "‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å"
                    if (!asset.location) {
                        asset.location = '‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - ‡πÇ‡∏ã‡∏ô A';
                    }
                    
                    return asset;
                });
                
                // Add to local storage
                assetsData = [...assetsData, ...processedData];
                localStorage.setItem('fmcgAssets', JSON.stringify(assetsData));
                
                // Save to Google Sheets if configured
                if (sheetsConfig.webAppUrl) {
                    await saveToGoogleSheets(processedData);
                }
                
                hideLoading();
                showNotification(`‚úÖ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${processedData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
                
                importData = [];
                document.getElementById('previewSection').style.display = 'none';
                document.getElementById('excelFile').value = '';
                
                updateDashboard();
                showPage('assets');
            } catch (error) {
                hideLoading();
                showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
            }
        }

        // Update Department Page Data
        function updateDepartmentPage() {
            if (assetsData.length === 0) {
                document.getElementById('departmentBreakdownBody').innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; color: #aaa; padding: 40px;">
                            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô
                        </td>
                    </tr>
                `;
                document.getElementById('departmentCardsGrid').innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #aaa;">
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠ Import Excel
                    </div>
                `;
                return;
            }

            // Group assets by department
            const departmentData = {};
            const departments = ['‡∏™‡∏≥‡∏£‡∏≠‡∏á', 'AC', 'AP', 'APB', 'CF', 'APL', 'CP', 'DP', 'INV', 'LS', 'QA', 'RC', 'ST'];
            
            departments.forEach(dept => {
                departmentData[dept] = {
                    ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå: 0,
                    '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°': 0,
                    ‡∏ä‡∏≥‡∏£‡∏∏‡∏î: 0,
                    ‡πÄ‡∏™‡∏µ‡∏¢: 0,
                    total: 0,
                    value: 0
                };
            });

            // Count assets by department and status
            assetsData.forEach(asset => {
                const dept = asset.department || '‡∏™‡∏≥‡∏£‡∏≠‡∏á';
                const status = asset.status || '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå';
                
                if (departmentData[dept]) {
                    if (departmentData[dept][status] !== undefined) {
                        departmentData[dept][status]++;
                    }
                    departmentData[dept].total++;
                    departmentData[dept].value += Number(asset.price) || 0;
                }
            });

            // Update total departments stat
            const activeDepts = Object.keys(departmentData).filter(dept => departmentData[dept].total > 0);
            document.getElementById('totalDepartments').textContent = activeDepts.length;

            // Calculate totals
            let totalComplete = 0, totalRepair = 0, totalDamaged = 0;
            Object.values(departmentData).forEach(data => {
                totalComplete += data.‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå;
                totalRepair += data['‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°'];
                totalDamaged += data.‡∏ä‡∏≥‡∏£‡∏∏‡∏î + data.‡πÄ‡∏™‡∏µ‡∏¢;
            });

            document.getElementById('totalComplete').textContent = totalComplete;
            document.getElementById('totalRepair').textContent = totalRepair;
            document.getElementById('totalDamaged').textContent = totalDamaged;

            // Render department breakdown table
            const tbody = document.getElementById('departmentBreakdownBody');
            tbody.innerHTML = departments.map(dept => {
                const data = departmentData[dept];
                if (data.total === 0) return ''; // Skip empty departments
                
                return `
                    <tr>
                        <td><strong>${dept}</strong></td>
                        <td style="text-align: center;">
                            <span class="badge complete">${data.‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå}</span>
                        </td>
                        <td style="text-align: center;">
                            <span class="badge repair">${data['‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°']}</span>
                        </td>
                        <td style="text-align: center;">
                            <span class="badge damaged">${data.‡∏ä‡∏≥‡∏£‡∏∏‡∏î}</span>
                        </td>
                        <td style="text-align: center;">
                            <span class="badge broken">${data.‡πÄ‡∏™‡∏µ‡∏¢}</span>
                        </td>
                        <td style="text-align: center;"><strong>${data.total}</strong></td>
                        <td>
                            <button class="action-btn view" onclick="viewDepartmentDetail('${dept}')">
                                <i class="fas fa-eye"></i> ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                            </button>
                        </td>
                    </tr>
                `;
            }).filter(row => row).join('');

            // Update department charts
            updateDepartmentCharts(departmentData);
            
            // Render department cards
            renderDepartmentCards(departmentData);
        }

        // Update Department Charts
        function updateDepartmentCharts(departmentData) {
            const departments = Object.keys(departmentData).filter(dept => departmentData[dept].total > 0);
            const totals = departments.map(dept => departmentData[dept].total);
            const colors = [
                '#14b8a6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', 
                '#8b5cf6', '#ec4899', '#f97316', '#6366f1', '#84cc16',
                '#06b6d4', '#f43f5e', '#14b8a6'
            ];

            // Bar Chart - Assets per Department
            const barCtx = document.getElementById('departmentAssetChart');
            if (barCtx) {
                if (barCtx.chart) {
                    barCtx.chart.destroy();
                }
                barCtx.chart = new Chart(barCtx, {
                    type: 'bar',
                    data: {
                        labels: departments,
                        datasets: [{
                            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô',
                            data: totals,
                            backgroundColor: colors.slice(0, departments.length)
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }

            // Pie Chart - Proportion by Department
            const pieCtx = document.getElementById('departmentPieChart');
            if (pieCtx) {
                if (pieCtx.chart) {
                    pieCtx.chart.destroy();
                }
                pieCtx.chart = new Chart(pieCtx, {
                    type: 'pie',
                    data: {
                        labels: departments,
                        datasets: [{
                            data: totals,
                            backgroundColor: colors.slice(0, departments.length)
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'right'
                            }
                        }
                    }
                });
            }
        }

        // Render Department Cards
        function renderDepartmentCards(departmentData) {
            const container = document.getElementById('departmentCardsGrid');
            if (!container) return;

            const departments = Object.keys(departmentData).filter(dept => departmentData[dept].total > 0);
            
            container.innerHTML = departments.map(dept => {
                const data = departmentData[dept];
                const percentage = {
                    complete: ((data.‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå / data.total) * 100).toFixed(1),
                    repair: ((data['‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°'] / data.total) * 100).toFixed(1),
                    damaged: ((data.‡∏ä‡∏≥‡∏£‡∏∏‡∏î / data.total) * 100).toFixed(1),
                    broken: ((data.‡πÄ‡∏™‡∏µ‡∏¢ / data.total) * 100).toFixed(1)
                };

                return `
                    <div class="table-container" style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div>
                                <h3 style="color: #333; font-size: 18px; margin-bottom: 5px;">
                                    <i class="fas fa-building"></i> ‡πÅ‡∏ú‡∏ô‡∏Å ${dept}
                                </h3>
                                <p style="color: #666; font-size: 14px;">
                                    ‡∏£‡∏ß‡∏° ${data.total} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ | ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ ‡∏ø${data.value.toLocaleString()}
                                </p>
                            </div>
                            <button class="btn btn-info" onclick="viewDepartmentDetail('${dept}')">
                                <i class="fas fa-eye"></i> ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                            </button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div style="padding: 15px; background: #d1fae5; border-radius: 10px; text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #065f46;">${data.‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå}</div>
                                <div style="font-size: 12px; color: #065f46; margin-top: 5px;">‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå (${percentage.complete}%)</div>
                            </div>
                            
                            <div style="padding: 15px; background: #fef3c7; border-radius: 10px; text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #92400e;">${data['‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°']}</div>
                                <div style="font-size: 12px; color: #92400e; margin-top: 5px;">‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏° (${percentage.repair}%)</div>
                            </div>
                            
                            <div style="padding: 15px; background: #fed7aa; border-radius: 10px; text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #9a3412;">${data.‡∏ä‡∏≥‡∏£‡∏∏‡∏î}</div>
                                <div style="font-size: 12px; color: #9a3412; margin-top: 5px;">‡∏ä‡∏≥‡∏£‡∏∏‡∏î (${percentage.damaged}%)</div>
                            </div>
                            
                            <div style="padding: 15px; background: #fee2e2; border-radius: 10px; text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #991b1b;">${data.‡πÄ‡∏™‡∏µ‡∏¢}</div>
                                <div style="font-size: 12px; color: #991b1b; margin-top: 5px;">‡πÄ‡∏™‡∏µ‡∏¢ (${percentage.broken}%)</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // View Department Detail
        function viewDepartmentDetail(department) {
            const deptAssets = assetsData.filter(a => (a.department || '‡∏™‡∏≥‡∏£‡∏≠‡∏á') === department);
            
            if (deptAssets.length === 0) {
                showNotification('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å‡∏ô‡∏µ‡πâ', 'warning');
                return;
            }

            // Create modal content
            const modalHtml = `
                <div class="modal active" id="departmentModal" onclick="if(event.target === this) closeDepartmentModal()">
                    <div class="modal-content" style="max-width: 1000px;">
                        <div class="modal-header">
                            <h3><i class="fas fa-building"></i> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏ú‡∏ô‡∏Å ${department}</h3>
                            <button class="close-modal" onclick="closeDepartmentModal()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));">
                                <div class="stat-card" style="padding: 15px;">
                                    <div class="stat-info">
                                        <h3>${deptAssets.length}</h3>
                                        <p>‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                    </div>
                                </div>
                                <div class="stat-card" style="padding: 15px;">
                                    <div class="stat-info">
                                        <h3>${deptAssets.filter(a => a.status === '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå').length}</h3>
                                        <p>‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</p>
                                    </div>
                                </div>
                                <div class="stat-card" style="padding: 15px;">
                                    <div class="stat-info">
                                        <h3>${deptAssets.filter(a => a.status === '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°').length}</h3>
                                        <p>‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°</p>
                                    </div>
                                </div>
                                <div class="stat-card" style="padding: 15px;">
                                    <div class="stat-info">
                                        <h3>‡∏ø${deptAssets.reduce((sum, a) => sum + (Number(a.price) || 0), 0).toLocaleString()}</h3>
                                        <p>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="overflow-x: auto;">
                            <table>
                                <thead>
                                    <tr>
                                        <th>‡∏£‡∏´‡∏±‡∏™</th>
                                        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</th>
                                        <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</th>
                                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                        <th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ø)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${deptAssets.map(asset => `
                                        <tr>
                                            <td>${asset.code}</td>
                                            <td>${asset.name}</td>
                                            <td>${asset.category}</td>
                                            <td>${asset.location}</td>
                                            <td><span class="badge ${getStatusClass(asset.status)}">${asset.status}</span></td>
                                            <td>${Number(asset.price).toLocaleString()}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="form-actions" style="margin-top: 20px;">
                            <button class="btn btn-success" onclick="exportDepartmentDetail('${department}')">
                                <i class="fas fa-file-excel"></i> Export Excel
                            </button>
                            <button class="btn btn-secondary" onclick="closeDepartmentModal()">
                                <i class="fas fa-times"></i> ‡∏õ‡∏¥‡∏î
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if any
            const existingModal = document.getElementById('departmentModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        // Close Department Modal
        function closeDepartmentModal() {
            const modal = document.getElementById('departmentModal');
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => modal.remove(), 300);
            }
        }

        // Export Department Detail
        function exportDepartmentDetail(department) {
            const deptAssets = assetsData.filter(a => (a.department || '‡∏™‡∏≥‡∏£‡∏≠‡∏á') === department);
            
            if (deptAssets.length === 0) {
                showNotification('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ Export', 'warning');
                return;
            }
            
            const data = deptAssets.map(asset => ({
                '‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô': asset.code,
                '‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô': asset.name,
                '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà': asset.category,
                '‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠': asset.brand,
                '‡∏£‡∏∏‡πà‡∏ô': asset.model,
                'Serial Number': asset.serial,
                '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠': asset.purchaseDate,
                '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠': asset.price,
                '‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö': asset.location,
                '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞': asset.status,
                '‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢': asset.description
            }));
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, `‡πÅ‡∏ú‡∏ô‡∏Å ${department}`);
            
            const date = new Date().toISOString().split('T')[0];
            XLSX.writeFile(wb, `Department_${department}_${date}.xlsx`);
            
            showNotification(`‚úÖ Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ú‡∏ô‡∏Å ${department} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
        }

        // Export Department Report
        function exportDepartmentReport() {
            if (assetsData.length === 0) {
                showNotification('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ Export', 'warning');
                return;
            }
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            
            // Summary sheet
            const departments = ['‡∏™‡∏≥‡∏£‡∏≠‡∏á', 'AC', 'AP', 'APB', 'CF', 'APL', 'CP', 'DP', 'INV', 'LS', 'QA', 'RC', 'ST'];
            const summaryData = [['‡πÅ‡∏ú‡∏ô‡∏Å', '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå', '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°', '‡∏ä‡∏≥‡∏£‡∏∏‡∏î', '‡πÄ‡∏™‡∏µ‡∏¢', '‡∏£‡∏ß‡∏°', '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏° (‡∏ø)']];
            
            departments.forEach(dept => {
                const deptAssets = assetsData.filter(a => (a.department || '‡∏™‡∏≥‡∏£‡∏≠‡∏á') === dept);
                if (deptAssets.length > 0) {
                    summaryData.push([
                        dept,
                        deptAssets.filter(a => a.status === '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå').length,
                        deptAssets.filter(a => a.status === '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°').length,
                        deptAssets.filter(a => a.status === '‡∏ä‡∏≥‡∏£‡∏∏‡∏î').length,
                        deptAssets.filter(a => a.status === '‡πÄ‡∏™‡∏µ‡∏¢').length,
                        deptAssets.length,
                        deptAssets.reduce((sum, a) => sum + (Number(a.price) || 0), 0)
                    ]);
                }
            });
            
            const summaryWs = XLSX.utils.aoa_to_sheet(summaryData);
            XLSX.utils.book_append_sheet(wb, summaryWs, '‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°');
            
            // Detail sheets for each department
            departments.forEach(dept => {
                const deptAssets = assetsData.filter(a => (a.department || '‡∏™‡∏≥‡∏£‡∏≠‡∏á') === dept);
                if (deptAssets.length > 0) {
                    const data = deptAssets.map(asset => ({
                        '‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô': asset.code,
                        '‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô': asset.name,
                        '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà': asset.category,
                        '‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà': asset.location,
                        '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞': asset.status,
                        '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤': asset.price
                    }));
                    
                    const ws = XLSX.utils.json_to_sheet(data);
                    XLSX.utils.book_append_sheet(wb, ws, dept);
                }
            });
            
            const date = new Date().toISOString().split('T')[0];
            XLSX.writeFile(wb, `Department_Report_${date}.xlsx`);
            
            showNotification('‚úÖ Export ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏¢‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        // Update Locations Page with Real Data
        // ========================================
        // üìç Location & Capacity Management
        // ========================================
        
        let locationCapacity = JSON.parse(localStorage.getItem('fmcgLocationCapacity') || '{}');

        function updateLocationsPage() {
            if (assetsData.length === 0) {
                const tbody = document.getElementById('locationsTableBody');
                if (tbody) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; color: #aaa; padding: 40px;">
                                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô
                            </td>
                        </tr>
                    `;
                }
                return;
            }

            // Count assets by location
            const locationData = {};
            
            assetsData.forEach(asset => {
                const loc = asset.location || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                if (!locationData[loc]) {
                    locationData[loc] = {
                        total: 0,
                        complete: 0
                    };
                }
                locationData[loc].total++;
                if (asset.status === '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå') {
                    locationData[loc].complete++;
                }
            });

            // Calculate totals
            const totalLocations = Object.keys(locationData).length;
            const totalAssets = assetsData.length;
            
            // Calculate average capacity usage
            let totalUsagePercent = 0;
            let locationsWithCap = 0;
            let fullLocationsCount = 0;
            
            Object.entries(locationData).forEach(([loc, data]) => {
                const maxCap = locationCapacity[loc] || 0;
                if (maxCap > 0) {
                    const usagePercent = (data.total / maxCap) * 100;
                    totalUsagePercent += usagePercent;
                    locationsWithCap++;
                    if (usagePercent >= 90) fullLocationsCount++;
                }
            });
            
            const avgCapacity = locationsWithCap > 0 
                ? Math.round(totalUsagePercent / locationsWithCap) 
                : 0;

            // Update stats
            document.getElementById('totalLocations').textContent = totalLocations;
            document.getElementById('avgCapacity').textContent = avgCapacity + '%';
            document.getElementById('totalAssetsInLocations').textContent = totalAssets;
            document.getElementById('fullLocations').textContent = fullLocationsCount;

            // Update location table
            const tbody = document.getElementById('locationsTableBody');
            if (tbody) {
                tbody.innerHTML = Object.entries(locationData).map(([location, data]) => {
                    const maxCap = locationCapacity[location] || 0;
                    const usagePercent = maxCap > 0 ? (data.total / maxCap) * 100 : 0;
                    
                    let statusClass, statusText;
                    if (maxCap === 0) {
                        statusClass = 'available';
                        statusText = '‡πÑ‡∏°‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î';
                    } else if (usagePercent >= 90) {
                        statusClass = 'broken';
                        statusText = '‡πÄ‡∏ï‡πá‡∏° (>90%)';
                    } else if (usagePercent >= 70) {
                        statusClass = 'maintenance';
                        statusText = '‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (70-90%)';
                    } else {
                        statusClass = 'complete';
                        statusText = '‡∏õ‡∏Å‡∏ï‡∏¥ (<70%)';
                    }
                    
                    const progressBarWidth = maxCap > 0 ? Math.min(usagePercent, 100) : 0;
                    const progressBarColor = usagePercent >= 90 ? '#ef4444' : usagePercent >= 70 ? '#f59e0b' : '#10b981';
                    
                    return `
                        <tr>
                            <td><strong>${location}</strong></td>
                            <td>-</td>
                            <td style="text-align: center; font-weight: 600;">${data.total}</td>
                            <td style="text-align: center;">
                                ${maxCap > 0 ? maxCap : '<span style="color: #999;">-</span>'}
                            </td>
                            <td>
                                ${maxCap > 0 ? `
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="flex: 1; background: #e5e5e5; border-radius: 10px; height: 20px; overflow: hidden;">
                                            <div style="background: ${progressBarColor}; width: ${progressBarWidth}%; height: 100%; 
                                                        display: flex; align-items: center; justify-content: center; 
                                                        color: white; font-size: 11px; font-weight: 600; transition: all 0.3s;">
                                                ${usagePercent.toFixed(1)}%
                                            </div>
                                        </div>
                                    </div>
                                ` : '<span style="color: #999;">-</span>'}
                            </td>
                            <td><span class="badge ${statusClass}">${statusText}</span></td>
                            <td style="text-align: center;">
                                <button class="action-btn primary" onclick="editCapacity('${location}', ${data.total})" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
        }

        function openCapacityModal() {
            // Show all locations to set capacity
            const locations = [...new Set(assetsData.map(a => a.location).filter(Boolean))];
            
            if (locations.length === 0) {
                showNotification('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô', 'warning');
                return;
            }
            
            // For now, just notify - could open a list selector
            showNotification('üí° ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏', 'success');
        }

        function editCapacity(locationName, currentCount) {
            document.getElementById('capacityLocationName').value = locationName;
            document.getElementById('capacityLocationDisplay').textContent = locationName;
            document.getElementById('capacityCurrentCount').textContent = currentCount;
            document.getElementById('capacityMaxValue').value = locationCapacity[locationName] || currentCount + 50;
            
            openModal('capacityModal');
        }

        function saveCapacity() {
            const locationName = document.getElementById('capacityLocationName').value;
            const maxValue = parseInt(document.getElementById('capacityMaxValue').value);
            
            if (!maxValue || maxValue < 1) {
                showNotification('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'warning');
                return;
            }
            
            locationCapacity[locationName] = maxValue;
            localStorage.setItem('fmcgLocationCapacity', JSON.stringify(locationCapacity));
            
            closeModal('capacityModal');
            updateLocationsPage();
            
            showNotification(`‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà "${locationName}" = ${maxValue} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
        }

        // Update Maintenance Page with Real Data
        function updateMaintenancePage() {
            if (assetsData.length === 0) {
                const tbody = document.getElementById('maintenanceTableBody');
                if (tbody) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; color: #aaa; padding: 40px;">
                                ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á
                            </td>
                        </tr>
                    `;
                }
                return;
            }

            // Calculate maintenance stats
            const scheduledCount = assetsData.filter(a => a.status === '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°').length;
            const inProgressCount = Math.ceil(scheduledCount / 2);
            const completedCount = assetsData.filter(a => a.status === '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå').length;
            const totalMaintenanceCost = assetsData
                .filter(a => a.status === '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°' || a.status === '‡∏ä‡∏≥‡∏£‡∏∏‡∏î')
                .reduce((sum, a) => sum + (Number(a.price) * 0.1), 0); // 10% of asset value as maintenance cost

            // Update stats
            document.getElementById('scheduledMaintenance').textContent = scheduledCount;
            document.getElementById('inProgressMaintenance').textContent = inProgressCount;
            document.getElementById('completedMaintenance').textContent = completedCount;
            
            const costK = Math.round(totalMaintenanceCost / 1000);
            document.getElementById('maintenanceCost').textContent = '‡∏ø' + costK + 'K';

            // Update maintenance table with actual repair items
            const tbody = document.getElementById('maintenanceTableBody');
            if (tbody) {
                const repairAssets = assetsData.filter(a => a.status === '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°' || a.status === '‡∏ä‡∏≥‡∏£‡∏∏‡∏î');
                
                if (repairAssets.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; color: #aaa; padding: 40px;">
                                ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á
                            </td>
                        </tr>
                    `;
                } else {
                    tbody.innerHTML = repairAssets.slice(0, 10).map(asset => {
                        const maintenanceType = asset.status === '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°' ? '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°' : '‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°';
                        const statusClass = asset.status === '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°' ? 'in-use' : 'maintenance';
                        const statusText = asset.status === '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' : '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£';
                        const dueDate = new Date(Date.now() + Math.random() * 30 * 24 * 60 * 60 * 1000).toLocaleDateString('th-TH');
                        
                        return `
                            <tr>
                                <td>${asset.code}</td>
                                <td>${asset.name}</td>
                                <td>${maintenanceType}</td>
                                <td>${dueDate}</td>
                                <td><span class="badge ${statusClass}">${statusText}</span></td>
                            </tr>
                        `;
                    }).join('');
                }
            }
        }

        // Update Reports Page with Real Data
        // ========================================
        // üìä Enhanced Reports Functions
        // ========================================
        
        let reportCharts = {};
        let reportDateRange = { start: null, end: null };

        function updateReportsPage() {
            if (assetsData.length === 0) {
                showNotification('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô', 'warning');
                return;
            }

            // Get filtered data
            const filteredData = getFilteredReportData();
            
            // Update summary stats
            updateReportSummaryStats(filteredData);
            
            // Update all charts
            updateValueBreakdownCharts(filteredData);
            updateQuantityCharts(filteredData);
            updateTrendChart(filteredData);
            updateTopAssetsTable(filteredData);
            updateDetailedStatsTable(filteredData);
            updateSummaryReport(filteredData);
        }

        function getFilteredReportData() {
            let filtered = [...assetsData];
            
            // Filter by date range
            if (reportDateRange.start && reportDateRange.end) {
                const startDate = new Date(reportDateRange.start);
                const endDate = new Date(reportDateRange.end);
                endDate.setHours(23, 59, 59);
                
                filtered = filtered.filter(asset => {
                    const assetDate = new Date(asset.createdAt || asset.purchaseDate);
                    return assetDate >= startDate && assetDate <= endDate;
                });
            }
            
            return filtered;
        }

        function updateReportSummaryStats(data) {
            const totalAssets = data.length;
            const totalValue = data.reduce((sum, a) => sum + (Number(a.price) || 0), 0);
            const avgValue = totalAssets > 0 ? totalValue / totalAssets : 0;
            const depreciation = totalValue * 0.15;
            const netValue = totalValue - depreciation;
            
            // Update display
            document.getElementById('reportTotalAssets').textContent = totalAssets.toLocaleString();
            document.getElementById('reportTotalValue').textContent = formatCurrency(totalValue);
            document.getElementById('reportAvgValue').textContent = formatCurrency(avgValue);
            document.getElementById('reportDepreciation').textContent = formatCurrency(depreciation);
            
            // Show change indicators (if comparing to previous period)
            // This can be enhanced later
        }

        function updateValueBreakdownCharts(data) {
            const groupBy = document.getElementById('reportGroupBy')?.value || 'category';
            
            // Group data
            const grouped = {};
            data.forEach(asset => {
                const key = asset[groupBy] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                if (!grouped[key]) {
                    grouped[key] = { count: 0, value: 0, items: [] };
                }
                grouped[key].count++;
                grouped[key].value += Number(asset.price) || 0;
                grouped[key].items.push(asset);
            });
            
            // Sort by value
            const sorted = Object.entries(grouped).sort((a, b) => b[1].value - a[1].value);
            
            // Update Category Chart
            updateValueChart('valueByCategory', sorted, '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà');
            updateValueTable('categoryValueTable', sorted);
            
            // Update other charts if needed
            if (groupBy === 'category') {
                updateLocationValueChart(data);
                updateDepartmentValueChart(data);
                updateStatusValueChart(data);
            }
        }

        function updateValueChart(canvasId, data, title) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            // Destroy existing chart
            if (reportCharts[canvasId]) {
                reportCharts[canvasId].destroy();
            }
            
            const labels = data.map(d => d[0]);
            const values = data.map(d => d[1].value);
            
            reportCharts[canvasId] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ø)',
                        data: values,
                        backgroundColor: 'rgba(20, 184, 166, 0.8)',
                        borderColor: 'rgba(20, 184, 166, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return formatCurrency(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrencyShort(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateValueTable(tableId, data) {
            const container = document.getElementById(tableId);
            if (!container) return;
            
            const total = data.reduce((sum, d) => sum + d[1].value, 0);
            
            container.innerHTML = `
                <table style="width: 100%; font-size: 13px;">
                    <thead style="background: #f0f9f9;">
                        <tr>
                            <th style="padding: 8px; text-align: left;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                            <th style="padding: 8px; text-align: right;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                            <th style="padding: 8px; text-align: right;">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤</th>
                            <th style="padding: 8px; text-align: right;">%</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.map(([name, info]) => `
                            <tr style="border-bottom: 1px solid #e5e5e5;">
                                <td style="padding: 8px;">${name}</td>
                                <td style="padding: 8px; text-align: right;">${info.count}</td>
                                <td style="padding: 8px; text-align: right;">${formatCurrency(info.value)}</td>
                                <td style="padding: 8px; text-align: right; color: var(--primary); font-weight: 600;">
                                    ${((info.value / total) * 100).toFixed(1)}%
                                </td>
                            </tr>
                        `).join('')}
                        <tr style="background: #f0f9f9; font-weight: 600;">
                            <td style="padding: 8px;">‡∏£‡∏ß‡∏°</td>
                            <td style="padding: 8px; text-align: right;">${data.reduce((s, d) => s + d[1].count, 0)}</td>
                            <td style="padding: 8px; text-align: right;">${formatCurrency(total)}</td>
                            <td style="padding: 8px; text-align: right;">100%</td>
                        </tr>
                    </tbody>
                </table>
            `;
        }

        function updateLocationValueChart(data) {
            const grouped = {};
            data.forEach(asset => {
                const key = asset.location || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                if (!grouped[key]) grouped[key] = { count: 0, value: 0 };
                grouped[key].count++;
                grouped[key].value += Number(asset.price) || 0;
            });
            
            const sorted = Object.entries(grouped).sort((a, b) => b[1].value - a[1].value);
            updateValueChart('valueByLocation', sorted, '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà');
            updateValueTable('locationValueTable', sorted);
        }

        function updateDepartmentValueChart(data) {
            const grouped = {};
            data.forEach(asset => {
                const key = asset.department || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                if (!grouped[key]) grouped[key] = { count: 0, value: 0 };
                grouped[key].count++;
                grouped[key].value += Number(asset.price) || 0;
            });
            
            const sorted = Object.entries(grouped).sort((a, b) => b[1].value - a[1].value);
            updateValueChart('valueByDepartment', sorted, '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å');
            updateValueTable('departmentValueTable', sorted);
        }

        function updateStatusValueChart(data) {
            const grouped = {};
            data.forEach(asset => {
                const key = asset.status || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                if (!grouped[key]) grouped[key] = { count: 0, value: 0 };
                grouped[key].count++;
                grouped[key].value += Number(asset.price) || 0;
            });
            
            const sorted = Object.entries(grouped).sort((a, b) => b[1].value - a[1].value);
            
            const ctx = document.getElementById('valueByStatus');
            if (!ctx) return;
            
            if (reportCharts['valueByStatus']) {
                reportCharts['valueByStatus'].destroy();
            }
            
            const colors = {
                '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå': '#10b981',
                '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°': '#f59e0b',
                '‡∏ä‡∏≥‡∏£‡∏∏‡∏î': '#ef4444',
                '‡πÄ‡∏™‡∏µ‡∏¢': '#991b1b'
            };
            
            reportCharts['valueByStatus'] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: sorted.map(d => d[0]),
                    datasets: [{
                        data: sorted.map(d => d[1].value),
                        backgroundColor: sorted.map(d => colors[d[0]] || '#6b7280'),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + formatCurrency(context.parsed);
                                }
                            }
                        }
                    }
                }
            });
            
            updateValueTable('statusValueTable', sorted);
        }

        function updateQuantityCharts(data) {
            // Count by category
            const categoryCount = {};
            data.forEach(asset => {
                const cat = asset.category || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                categoryCount[cat] = (categoryCount[cat] || 0) + 1;
            });
            
            const sorted = Object.entries(categoryCount).sort((a, b) => b[1] - a[1]);
            
            const ctx1 = document.getElementById('countByCategory');
            if (ctx1) {
                if (reportCharts['countByCategory']) reportCharts['countByCategory'].destroy();
                
                reportCharts['countByCategory'] = new Chart(ctx1, {
                    type: 'bar',
                    data: {
                        labels: sorted.map(d => d[0]),
                        datasets: [{
                            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô',
                            data: sorted.map(d => d[1]),
                            backgroundColor: 'rgba(6, 182, 212, 0.8)',
                            borderColor: 'rgba(6, 182, 212, 1)',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } },
                        scales: { y: { beginAtZero: true } }
                    }
                });
            }
            
            // Status pie chart
            const statusCount = {};
            data.forEach(asset => {
                const status = asset.status || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                statusCount[status] = (statusCount[status] || 0) + 1;
            });
            
            const ctx2 = document.getElementById('statusPieChart');
            if (ctx2) {
                if (reportCharts['statusPieChart']) reportCharts['statusPieChart'].destroy();
                
                const colors = {
                    '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå': '#10b981',
                    '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°': '#f59e0b',
                    '‡∏ä‡∏≥‡∏£‡∏∏‡∏î': '#ef4444',
                    '‡πÄ‡∏™‡∏µ‡∏¢': '#991b1b'
                };
                
                reportCharts['statusPieChart'] = new Chart(ctx2, {
                    type: 'pie',
                    data: {
                        labels: Object.keys(statusCount),
                        datasets: [{
                            data: Object.values(statusCount),
                            backgroundColor: Object.keys(statusCount).map(s => colors[s] || '#6b7280'),
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { position: 'bottom' } }
                    }
                });
            }
        }

        function updateTrendChart(data) {
            // Group by month
            const monthlyData = {};
            data.forEach(asset => {
                const date = new Date(asset.createdAt || asset.purchaseDate);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                monthlyData[monthKey] = (monthlyData[monthKey] || 0) + 1;
            });
            
            const sorted = Object.entries(monthlyData).sort((a, b) => a[0].localeCompare(b[0]));
            
            const ctx = document.getElementById('trendChart');
            if (!ctx) return;
            
            if (reportCharts['trendChart']) reportCharts['trendChart'].destroy();
            
            // Calculate cumulative
            let cumulative = 0;
            const cumulativeData = sorted.map(d => {
                cumulative += d[1];
                return cumulative;
            });
            
            reportCharts['trendChart'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sorted.map(d => {
                        const [year, month] = d[0].split('-');
                        return `${month}/${year}`;
                    }),
                    datasets: [
                        {
                            label: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
                            data: sorted.map(d => d[1]),
                            borderColor: 'rgba(16, 185, 129, 1)',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: '‡∏™‡∏∞‡∏™‡∏°‡∏£‡∏ß‡∏°',
                            data: cumulativeData,
                            borderColor: 'rgba(20, 184, 166, 1)',
                            backgroundColor: 'rgba(20, 184, 166, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
            
            // Update department trend charts
            updateDepartmentTrendCharts(data);
        }

        // ========================================
        // üìä Department Holdings Trend Charts
        // ========================================
        
        function updateDepartmentTrendCharts(data) {
            // Get all unique months
            const allMonths = new Set();
            data.forEach(asset => {
                const date = new Date(asset.createdAt || asset.purchaseDate);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                allMonths.add(monthKey);
            });
            
            const sortedMonths = Array.from(allMonths).sort();
            
            // Get all departments
            const departments = [...new Set(data.map(a => a.department).filter(Boolean))];
            
            // Generate colors for departments
            const colors = [
                '#14b8a6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444',
                '#8b5cf6', '#ec4899', '#6366f1', '#84cc16', '#f97316'
            ];
            
            // Calculate cumulative holdings by department per month
            const departmentMonthlyData = {};
            
            departments.forEach(dept => {
                departmentMonthlyData[dept] = {
                    count: [],
                    value: []
                };
                
                let cumulativeCount = 0;
                let cumulativeValue = 0;
                
                sortedMonths.forEach(month => {
                    // Count assets added up to this month
                    const assetsInMonth = data.filter(asset => {
                        const deptMatch = asset.department === dept;
                        const assetDate = new Date(asset.createdAt || asset.purchaseDate);
                        const assetMonth = `${assetDate.getFullYear()}-${String(assetDate.getMonth() + 1).padStart(2, '0')}`;
                        return deptMatch && assetMonth <= month;
                    });
                    
                    cumulativeCount = assetsInMonth.length;
                    cumulativeValue = assetsInMonth.reduce((sum, a) => sum + (Number(a.price) || 0), 0);
                    
                    departmentMonthlyData[dept].count.push(cumulativeCount);
                    departmentMonthlyData[dept].value.push(cumulativeValue);
                });
            });
            
            // Create Value Trend Chart
            const valueCtx = document.getElementById('departmentValueTrendChart');
            if (valueCtx) {
                if (reportCharts['departmentValueTrendChart']) {
                    reportCharts['departmentValueTrendChart'].destroy();
                }
                
                const valueDatasets = departments.map((dept, index) => ({
                    label: dept,
                    data: departmentMonthlyData[dept].value,
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length] + '20',
                    tension: 0.4,
                    fill: false,
                    borderWidth: 2
                }));
                
                reportCharts['departmentValueTrendChart'] = new Chart(valueCtx, {
                    type: 'line',
                    data: {
                        labels: sortedMonths.map(m => {
                            const [year, month] = m.split('-');
                            return `${month}/${year}`;
                        }),
                        datasets: valueDatasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { 
                                position: 'bottom',
                                labels: { boxWidth: 12 }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return formatCurrencyShort(value);
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Create Count Trend Chart
            const countCtx = document.getElementById('departmentCountTrendChart');
            if (countCtx) {
                if (reportCharts['departmentCountTrendChart']) {
                    reportCharts['departmentCountTrendChart'].destroy();
                }
                
                const countDatasets = departments.map((dept, index) => ({
                    label: dept,
                    data: departmentMonthlyData[dept].count,
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length] + '20',
                    tension: 0.4,
                    fill: false,
                    borderWidth: 2
                }));
                
                reportCharts['departmentCountTrendChart'] = new Chart(countCtx, {
                    type: 'line',
                    data: {
                        labels: sortedMonths.map(m => {
                            const [year, month] = m.split('-');
                            return `${month}/${year}`;
                        }),
                        datasets: countDatasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { 
                                position: 'bottom',
                                labels: { boxWidth: 12 }
                            }
                        },
                        scales: {
                            y: { 
                                beginAtZero: true,
                                ticks: {
                                    precision: 0
                                }
                            }
                        }
                    }
                });
            }
        }

        function updateTopAssetsTable(data) {
            const tbody = document.getElementById('topAssetsTable');
            if (!tbody) return;
            
            const sorted = [...data].sort((a, b) => (Number(b.price) || 0) - (Number(a.price) || 0));
            const top10 = sorted.slice(0, 10);
            
            if (top10.length === 0) {
                tbody.innerHTML = `
                    <tr><td colspan="8" style="text-align: center; padding: 40px; color: #aaa;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>
                `;
                return;
            }
            
            tbody.innerHTML = top10.map((asset, index) => `
                <tr>
                    <td style="text-align: center; font-weight: 600;">
                        <span style="display: inline-flex; align-items: center; justify-content: center; 
                                     width: 30px; height: 30px; border-radius: 50%; 
                                     background: ${index < 3 ? 'linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)' : '#e5e5e5'}; 
                                     color: ${index < 3 ? 'white' : '#666'};">
                            ${index + 1}
                        </span>
                    </td>
                    <td>${asset.code}</td>
                    <td>${asset.name}</td>
                    <td>${asset.category}</td>
                    <td>${asset.location}</td>
                    <td>${asset.department || '-'}</td>
                    <td style="font-weight: 600; color: var(--primary);">${formatCurrency(asset.price)}</td>
                    <td><span class="badge ${getStatusClass(asset.status)}">${asset.status}</span></td>
                </tr>
            `).join('');
        }

        function updateDetailedStatsTable(data) {
            const tbody = document.getElementById('detailedStatsBody');
            if (!tbody) return;
            
            const groupBy = document.getElementById('reportGroupBy')?.value || 'category';
            
            // Group data
            const grouped = {};
            data.forEach(asset => {
                const key = asset[groupBy] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                if (!grouped[key]) {
                    grouped[key] = {
                        count: 0,
                        value: 0,
                        prices: [],
                        ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå: 0,
                        '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°': 0,
                        ‡∏ä‡∏≥‡∏£‡∏∏‡∏î: 0,
                        ‡πÄ‡∏™‡∏µ‡∏¢: 0
                    };
                }
                grouped[key].count++;
                grouped[key].value += Number(asset.price) || 0;
                grouped[key].prices.push(Number(asset.price) || 0);
                grouped[key][asset.status]++;
            });
            
            const total = data.length;
            const sorted = Object.entries(grouped).sort((a, b) => b[1].value - a[1].value);
            
            tbody.innerHTML = sorted.map(([name, stats]) => {
                const avg = stats.count > 0 ? stats.value / stats.count : 0;
                const max = Math.max(...stats.prices);
                const min = Math.min(...stats.prices);
                const percent = ((stats.count / total) * 100).toFixed(1);
                
                return `
                    <tr>
                        <td style="font-weight: 600;">${name}</td>
                        <td style="text-align: right;">${stats.count}</td>
                        <td style="text-align: right; color: var(--primary);">${percent}%</td>
                        <td style="text-align: right; font-weight: 600;">${formatCurrency(stats.value)}</td>
                        <td style="text-align: right;">${formatCurrency(avg)}</td>
                        <td style="text-align: right; color: #10b981;">${formatCurrency(max)}</td>
                        <td style="text-align: right; color: #ef4444;">${formatCurrency(min)}</td>
                        <td style="text-align: right;">${stats.‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå || 0}</td>
                        <td style="text-align: right;">${stats['‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°'] || 0}</td>
                        <td style="text-align: right;">${stats.‡∏ä‡∏≥‡∏£‡∏∏‡∏î || 0}</td>
                        <td style="text-align: right;">${stats.‡πÄ‡∏™‡∏µ‡∏¢ || 0}</td>
                    </tr>
                `;
            }).join('');
        }

        function updateSummaryReport(data) {
            const container = document.getElementById('summaryReport');
            if (!container) return;
            
            const totalAssets = data.length;
            const totalValue = data.reduce((sum, a) => sum + (Number(a.price) || 0), 0);
            const avgValue = totalAssets > 0 ? totalValue / totalAssets : 0;
            
            const statusCount = {};
            data.forEach(a => {
                statusCount[a.status] = (statusCount[a.status] || 0) + 1;
            });
            
            const categories = [...new Set(data.map(a => a.category))].length;
            const locations = [...new Set(data.map(a => a.location))].length;
            const departments = [...new Set(data.map(a => a.department).filter(Boolean))].length;
            
            const depreciation = totalValue * 0.15;
            const netValue = totalValue - depreciation;
            
            const dateRange = reportDateRange.start && reportDateRange.end 
                ? `‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤: ${formatThaiDate(reportDateRange.start)} - ${formatThaiDate(reportDateRange.end)}`
                : '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
            
            container.innerHTML = `
                <p><strong>üìÖ ${dateRange}</strong></p>
                <p>üì¶ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <strong>${totalAssets.toLocaleString()}</strong> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                <p>üí∞ ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°: <strong>${formatCurrency(totalValue)}</strong></p>
                <p>üìä ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: <strong>${formatCurrency(avgValue)}</strong> ‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô</p>
                <p>üìâ ‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤ (15%): <strong>${formatCurrency(depreciation)}</strong></p>
                <p>üíé ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: <strong style="color: var(--primary);">${formatCurrency(netValue)}</strong></p>
                <hr style="margin: 15px 0; border: none; border-top: 1px solid #ccc;">
                <p>üè∑Ô∏è ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: <strong>${categories}</strong> ‡∏´‡∏°‡∏ß‡∏î</p>
                <p>üìç ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: <strong>${locations}</strong> ‡πÅ‡∏´‡πà‡∏á</p>
                <p>üè¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å: <strong>${departments}</strong> ‡πÅ‡∏ú‡∏ô‡∏Å</p>
                <hr style="margin: 15px 0; border: none; border-top: 1px solid #ccc;">
                <p>‚úÖ ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå: <strong>${statusCount['‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå'] || 0}</strong> (${((statusCount['‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå'] || 0) / totalAssets * 100).toFixed(1)}%)</p>
                <p>üîß ‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°: <strong>${statusCount['‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°'] || 0}</strong> (${((statusCount['‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°'] || 0) / totalAssets * 100).toFixed(1)}%)</p>
                <p>‚ö†Ô∏è ‡∏ä‡∏≥‡∏£‡∏∏‡∏î: <strong>${statusCount['‡∏ä‡∏≥‡∏£‡∏∏‡∏î'] || 0}</strong> (${((statusCount['‡∏ä‡∏≥‡∏£‡∏∏‡∏î'] || 0) / totalAssets * 100).toFixed(1)}%)</p>
                <p>‚ùå ‡πÄ‡∏™‡∏µ‡∏¢: <strong>${statusCount['‡πÄ‡∏™‡∏µ‡∏¢'] || 0}</strong> (${((statusCount['‡πÄ‡∏™‡∏µ‡∏¢'] || 0) / totalAssets * 100).toFixed(1)}%)</p>
            `;
        }

        // Date Range Functions
        function applyQuickDateRange() {
            const select = document.getElementById('quickDateRange');
            const range = select.value;
            
            const today = new Date();
            let startDate, endDate;
            
            switch(range) {
                case 'today':
                    startDate = endDate = today;
                    break;
                case 'week':
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - 7);
                    endDate = today;
                    break;
                case 'month':
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - 30);
                    endDate = today;
                    break;
                case 'quarter':
                    startDate = new Date(today);
                    startDate.setMonth(today.getMonth() - 3);
                    endDate = today;
                    break;
                case 'year':
                    startDate = new Date(today.getFullYear(), 0, 1);
                    endDate = today;
                    break;
                case 'all':
                    startDate = null;
                    endDate = null;
                    break;
            }
            
            if (startDate) {
                document.getElementById('reportStartDate').value = startDate.toISOString().split('T')[0];
                document.getElementById('reportEndDate').value = endDate.toISOString().split('T')[0];
                reportDateRange.start = startDate.toISOString().split('T')[0];
                reportDateRange.end = endDate.toISOString().split('T')[0];
            } else {
                document.getElementById('reportStartDate').value = '';
                document.getElementById('reportEndDate').value = '';
                reportDateRange.start = null;
                reportDateRange.end = null;
            }
            
            updateReportsPage();
        }

        function updateReportsByDateRange() {
            const start = document.getElementById('reportStartDate').value;
            const end = document.getElementById('reportEndDate').value;
            
            reportDateRange.start = start;
            reportDateRange.end = end;
            
            updateReportsPage();
        }

        function refreshReports() {
            updateReportsPage();
            showNotification('‚úÖ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        function exportDetailedReport() {
            if (assetsData.length === 0) {
                showNotification('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ Export', 'warning');
                return;
            }
            
            const data = getFilteredReportData();
            
            // Prepare data for export
            const exportData = data.map(asset => ({
                '‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô': asset.code,
                '‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô': asset.name,
                '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà': asset.category,
                '‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠': asset.brand,
                '‡∏£‡∏∏‡πà‡∏ô': asset.model,
                'Serial Number': asset.serial,
                '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠': asset.purchaseDate,
                '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠': asset.price,
                '‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö': asset.location,
                '‡πÅ‡∏ú‡∏ô‡∏Å': asset.department || '',
                '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞': asset.status,
                '‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢': asset.description,
                '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á': asset.createdAt
            }));
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Detailed Report');
            
            const dateStr = reportDateRange.start && reportDateRange.end
                ? `_${reportDateRange.start}_to_${reportDateRange.end}`
                : '';
            
            XLSX.writeFile(wb, `Detailed_Asset_Report${dateStr}_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            showNotification('‚úÖ Export Excel ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        // ========================================
        // üìÑ Export Report to PDF
        // ========================================
        
        async function exportReportToPDF() {
            if (assetsData.length === 0) {
                showNotification('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ Export', 'warning');
                return;
            }
            
            showLoading();
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                
                const data = getFilteredReportData();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 20;
                
                // ========================================
                // üìã ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 1: ‡∏õ‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                // ========================================
                
                // Logo & Title
                doc.setFontSize(24);
                doc.setTextColor(20, 184, 166);
                doc.text('FMCG Asset Management', pageWidth / 2, yPos, { align: 'center' });
                
                yPos += 10;
                doc.setFontSize(16);
                doc.setTextColor(0, 0, 0);
                doc.text('‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î', pageWidth / 2, yPos, { align: 'center' });
                
                // Date Range
                yPos += 15;
                doc.setFontSize(12);
                doc.setTextColor(100, 100, 100);
                const dateRangeText = reportDateRange.start && reportDateRange.end
                    ? `‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤: ${formatThaiDate(reportDateRange.start)} - ${formatThaiDate(reportDateRange.end)}`
                    : '‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤: ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
                doc.text(dateRangeText, pageWidth / 2, yPos, { align: 'center' });
                
                yPos += 5;
                doc.setFontSize(10);
                doc.text(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${new Date().toLocaleString('th-TH')}`, pageWidth / 2, yPos, { align: 'center' });
                
                // Summary Statistics
                yPos += 15;
                doc.setFontSize(14);
                doc.setTextColor(20, 184, 166);
                doc.text('üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ß‡∏°', 15, yPos);
                
                yPos += 10;
                doc.setFontSize(11);
                doc.setTextColor(0, 0, 0);
                
                const totalAssets = data.length;
                const totalValue = data.reduce((sum, a) => sum + (Number(a.price) || 0), 0);
                const avgValue = totalAssets > 0 ? totalValue / totalAssets : 0;
                const depreciation = totalValue * 0.15;
                const netValue = totalValue - depreciation;
                
                const statusCount = {};
                data.forEach(a => {
                    statusCount[a.status] = (statusCount[a.status] || 0) + 1;
                });
                
                const categories = [...new Set(data.map(a => a.category))].length;
                const locations = [...new Set(data.map(a => a.location))].length;
                const departments = [...new Set(data.map(a => a.department).filter(Boolean))].length;
                
                const summaryData = [
                    `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalAssets.toLocaleString()} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`,
                    `‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°: ${formatCurrency(totalValue)}`,
                    `‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: ${formatCurrency(avgValue)} / ‡∏ä‡∏¥‡πâ‡∏ô`,
                    `‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤ (15%): ${formatCurrency(depreciation)}`,
                    `‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${formatCurrency(netValue)}`,
                    '',
                    `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: ${categories} ‡∏´‡∏°‡∏ß‡∏î`,
                    `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: ${locations} ‡πÅ‡∏´‡πà‡∏á`,
                    `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å: ${departments} ‡πÅ‡∏ú‡∏ô‡∏Å`,
                    '',
                    `‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå: ${statusCount['‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå'] || 0} (${((statusCount['‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå'] || 0) / totalAssets * 100).toFixed(1)}%)`,
                    `‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°: ${statusCount['‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°'] || 0} (${((statusCount['‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°'] || 0) / totalAssets * 100).toFixed(1)}%)`,
                    `‡∏ä‡∏≥‡∏£‡∏∏‡∏î: ${statusCount['‡∏ä‡∏≥‡∏£‡∏∏‡∏î'] || 0} (${((statusCount['‡∏ä‡∏≥‡∏£‡∏∏‡∏î'] || 0) / totalAssets * 100).toFixed(1)}%)`,
                    `‡πÄ‡∏™‡∏µ‡∏¢: ${statusCount['‡πÄ‡∏™‡∏µ‡∏¢'] || 0} (${((statusCount['‡πÄ‡∏™‡∏µ‡∏¢'] || 0) / totalAssets * 100).toFixed(1)}%)`
                ];
                
                summaryData.forEach(line => {
                    doc.text(line, 20, yPos);
                    yPos += 6;
                });
                
                // ========================================
                // üìä ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 2-3: ‡∏Å‡∏£‡∏≤‡∏ü
                // ========================================
                
                doc.addPage();
                yPos = 20;
                
                doc.setFontSize(14);
                doc.setTextColor(20, 184, 166);
                doc.text('üìà ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏†‡∏π‡∏°‡∏¥', 15, yPos);
                
                yPos += 10;
                
                // Capture charts
                const charts = [
                    { id: 'valueByCategory', title: '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà' },
                    { id: 'countByCategory', title: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà' },
                    { id: 'statusPieChart', title: '‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞' },
                    { id: 'trendChart', title: '‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô' }
                ];
                
                for (let i = 0; i < charts.length; i++) {
                    const chart = charts[i];
                    const canvas = document.getElementById(chart.id);
                    
                    if (canvas) {
                        try {
                            const imgData = canvas.toDataURL('image/png');
                            const imgWidth = pageWidth - 30;
                            const imgHeight = 60;
                            
                            if (yPos + imgHeight + 15 > pageHeight - 20) {
                                doc.addPage();
                                yPos = 20;
                            }
                            
                            doc.setFontSize(11);
                            doc.setTextColor(0, 0, 0);
                            doc.text(chart.title, 15, yPos);
                            yPos += 5;
                            
                            doc.addImage(imgData, 'PNG', 15, yPos, imgWidth, imgHeight);
                            yPos += imgHeight + 10;
                        } catch (error) {
                            console.error(`Error capturing chart ${chart.id}:`, error);
                        }
                    }
                }
                
                // ========================================
                // üèÜ ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 4: Top 10 Assets
                // ========================================
                
                doc.addPage();
                yPos = 20;
                
                doc.setFontSize(14);
                doc.setTextColor(20, 184, 166);
                doc.text('üèÜ Top 10 ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î', 15, yPos);
                
                yPos += 10;
                
                const sorted = [...data].sort((a, b) => (Number(b.price) || 0) - (Number(a.price) || 0));
                const top10 = sorted.slice(0, 10);
                
                doc.setFontSize(9);
                doc.setTextColor(0, 0, 0);
                
                // Table header
                const colWidths = [15, 30, 50, 35, 30];
                let xPos = 15;
                
                doc.setFillColor(20, 184, 166);
                doc.setTextColor(255, 255, 255);
                doc.rect(15, yPos, pageWidth - 30, 7, 'F');
                
                doc.text('‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö', xPos + 2, yPos + 5);
                xPos += colWidths[0];
                doc.text('‡∏£‡∏´‡∏±‡∏™', xPos + 2, yPos + 5);
                xPos += colWidths[1];
                doc.text('‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô', xPos + 2, yPos + 5);
                xPos += colWidths[2];
                doc.text('‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', xPos + 2, yPos + 5);
                xPos += colWidths[3];
                doc.text('‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤', xPos + 2, yPos + 5);
                
                yPos += 7;
                
                // Table rows
                doc.setTextColor(0, 0, 0);
                top10.forEach((asset, index) => {
                    if (yPos > pageHeight - 20) {
                        doc.addPage();
                        yPos = 20;
                    }
                    
                    xPos = 15;
                    
                    // Alternating row colors
                    if (index % 2 === 0) {
                        doc.setFillColor(240, 249, 249);
                        doc.rect(15, yPos, pageWidth - 30, 7, 'F');
                    }
                    
                    doc.text(`${index + 1}`, xPos + 2, yPos + 5);
                    xPos += colWidths[0];
                    doc.text(asset.code.substring(0, 12), xPos + 2, yPos + 5);
                    xPos += colWidths[1];
                    doc.text(asset.name.substring(0, 25), xPos + 2, yPos + 5);
                    xPos += colWidths[2];
                    doc.text(asset.category.substring(0, 15), xPos + 2, yPos + 5);
                    xPos += colWidths[3];
                    doc.text(formatCurrency(asset.price), xPos + 2, yPos + 5);
                    
                    yPos += 7;
                });
                
                // ========================================
                // üìã Footer
                // ========================================
                
                const totalPages = doc.internal.getNumberOfPages();
                for (let i = 1; i <= totalPages; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(150, 150, 150);
                    doc.text(
                        `FMCG Asset Management System - ‡∏´‡∏ô‡πâ‡∏≤ ${i}/${totalPages}`,
                        pageWidth / 2,
                        pageHeight - 10,
                        { align: 'center' }
                    );
                }
                
                // Save PDF
                const dateStr = reportDateRange.start && reportDateRange.end
                    ? `_${reportDateRange.start}_to_${reportDateRange.end}`
                    : '';
                
                doc.save(`Asset_Report${dateStr}_${new Date().toISOString().split('T')[0]}.pdf`);
                
                hideLoading();
                showNotification('‚úÖ Export PDF ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                
            } catch (error) {
                hideLoading();
                console.error('PDF Export Error:', error);
                showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Export PDF: ' + error.message, 'error');
            }
        }

        // Utility Functions
        function formatCurrency(value) {
            return '‡∏ø' + Number(value).toLocaleString('th-TH', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
        }

        function formatCurrencyShort(value) {
            if (value >= 1000000) {
                return '‡∏ø' + (value / 1000000).toFixed(1) + 'M';
            } else if (value >= 1000) {
                return '‡∏ø' + (value / 1000).toFixed(0) + 'K';
            }
            return '‡∏ø' + value.toFixed(0);
        }

        function formatThaiDate(dateStr) {
            const date = new Date(dateStr);
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Load Data from Google Sheets
        async function loadFromGoogleSheets() {
            const webAppUrl = sheetsConfig.webAppUrl || GOOGLE_APPS_SCRIPT_URL;
            
            if (!webAppUrl) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Web App URL ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö', 'error');
                return;
            }
            
            showLoading();
            
            // ‚ö° ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Sheets API ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ (‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤)
            if (USE_SHEETS_API && SHEETS_API_KEY && SPREADSHEET_ID) {
                try {
                    await loadFromSheetsAPI();
                    return;
                } catch (error) {
                    console.warn('Sheets API failed, fallback to Apps Script:', error);
                    // ‡∏ñ‡πâ‡∏≤ Sheets API ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ Apps Script ‡πÅ‡∏ó‡∏ô
                }
            }
            
            // üìù ‡πÉ‡∏ä‡πâ Google Apps Script (‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏≥‡∏£‡∏≠‡∏á)
            try {
                const response = await fetch(webAppUrl);
                
                if (!response.ok) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                }
                
                const result = await response.json();
                
                if (!result.success || !result.data || result.data.length <= 1) {
                    hideLoading();
                    showNotification('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Google Sheets', 'warning');
                    return;
                }
                
                const loadedAssets = result.data.slice(1).map(row => ({
                    code: row[0] || '',
                    name: row[1] || '',
                    category: row[2] || '',
                    brand: row[3] || '',
                    model: row[4] || '',
                    serial: row[5] || '',
                    purchaseDate: row[6] || '',
                    price: row[7] || 0,
                    location: row[8] || '',
                    department: row[9] || '',
                    status: row[10] || '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå',
                    description: row[11] || '',
                    createdAt: row[12] || new Date().toISOString()
                })).filter(asset => asset.code && asset.name);
                
                assetsData = loadedAssets;
                localStorage.setItem('fmcgAssets', JSON.stringify(assetsData));
                
                hideLoading();
                showNotification(`‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${loadedAssets.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (Apps Script)`, 'success');
                
                updateDashboard();
                renderAssetsTable();
                
            } catch (error) {
                hideLoading();
                showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
            }
        }

        // ‚ö° Load Data from Google Sheets API (‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ Apps Script)
        async function loadFromSheetsAPI() {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${SHEET_NAME}?key=${SHEETS_API_KEY}`;
            
            const response = await fetch(url);
            
            if (!response.ok) {
                throw new Error('Sheets API Error: ' + response.status);
            }
            
            const data = await response.json();
            
            if (!data.values || data.values.length <= 1) {
                hideLoading();
                showNotification('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Google Sheets', 'warning');
                return;
            }
            
            // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Sheets API
            const loadedAssets = data.values.slice(1).map(row => ({
                code: row[0] || '',
                name: row[1] || '',
                category: row[2] || '',
                brand: row[3] || '',
                model: row[4] || '',
                serial: row[5] || '',
                purchaseDate: row[6] || '',
                price: row[7] || 0,
                location: row[8] || '',
                department: row[9] || '',
                status: row[10] || '‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå',
                description: row[11] || '',
                createdAt: row[12] || new Date().toISOString()
            })).filter(asset => asset.code && asset.name);
            
            assetsData = loadedAssets;
            localStorage.setItem('fmcgAssets', JSON.stringify(assetsData));
            
            hideLoading();
            showNotification(`‚ö° ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${loadedAssets.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (Sheets API - ‡πÄ‡∏£‡πá‡∏ß)`, 'success');
            
            updateDashboard();
            renderAssetsTable();
        }

        // Save to Google Sheets
        async function saveToGoogleSheets(assets) {
            const webAppUrl = sheetsConfig.webAppUrl || GOOGLE_APPS_SCRIPT_URL;
            
            if (!webAppUrl) {
                throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Web App URL ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö');
            }
            
            const rows = assets.map(asset => [
                asset.code, asset.name, asset.category, asset.brand, asset.model,
                asset.serial, asset.purchaseDate, asset.price, asset.location,
                asset.department || '', asset.status, asset.description, asset.createdAt
            ]);
            
            const response = await fetch(webAppUrl, {
                method: 'POST',
                body: JSON.stringify({
                    action: 'append',
                    rows: rows
                })
            });
            
            if (!response.ok) {
                throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
            }
            
            const result = await response.json();
            
            if (!result.success) {
                throw new Error(result.error || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
            }
            
            return result;
        }

        // Initialize Google Sheets with Headers
        async function initializeGoogleSheets() {
            const webAppUrl = sheetsConfig.webAppUrl || GOOGLE_APPS_SCRIPT_URL;
            
            if (!webAppUrl) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Web App URL ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö', 'warning');
                return;
            }
            
            showLoading();
            
            try {
                const headers = [
                    '‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô', '‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô', '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', '‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠', '‡∏£‡∏∏‡πà‡∏ô', 
                    'Serial Number', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠', '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö', '‡πÅ‡∏ú‡∏ô‡∏Å', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', 
                    '‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á'
                ];
                
                const response = await fetch(webAppUrl, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'initialize',
                        headers: headers
                    })
                });
                
                if (!response.ok) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÑ‡∏î‡πâ');
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
                }
                
                hideLoading();
                showNotification('‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                
            } catch (error) {
                hideLoading();
                showNotification('‚ùå ' + error.message, 'error');
            }
        }

        // Test Connection
        async function testConnection() {
            let webAppUrl = document.getElementById('webAppUrl').value.trim();
            
            // ‚≠ê ‡∏ñ‡πâ‡∏≤ input ‡∏ß‡πà‡∏≤‡∏á ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ default
            if (!webAppUrl) {
                webAppUrl = GOOGLE_APPS_SCRIPT_URL;
                document.getElementById('webAppUrl').value = webAppUrl;
            }
            
            if (!webAppUrl) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Web App URL', 'warning');
                return;
            }
            
            showLoading();
            
            try {
                const response = await fetch(webAppUrl);
                
                if (!response.ok) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ');
                }
                
                const data = await response.json();
                
                sheetsConfig = { webAppUrl, sheetName: 'Assets' };
                localStorage.setItem('fmcgSheetsConfig', JSON.stringify(sheetsConfig));
                
                hideLoading();
                
                const resultDiv = document.getElementById('connectionResult');
                resultDiv.style.display = 'block';
                resultDiv.style.background = '#d1fae5';
                resultDiv.style.border = '1px solid #10b981';
                resultDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px; color: #065f46;">
                        <i class="fas fa-check-circle" style="font-size: 24px;"></i>
                        <div>
                            <strong>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</strong>
                            <p style="margin-top: 5px;">‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${data.data ? data.data.length - 1 : 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                        </div>
                    </div>
                `;
                
                updateSheetsStatus(true);
                showNotification('‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Apps Script ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                
            } catch (error) {
                hideLoading();
                
                const resultDiv = document.getElementById('connectionResult');
                resultDiv.style.display = 'block';
                resultDiv.style.background = '#fee2e2';
                resultDiv.style.border = '1px solid #ef4444';
                resultDiv.innerHTML = `
                    <div style="display: flex; align-items: start; gap: 10px; color: #991b1b;">
                        <i class="fas fa-times-circle" style="font-size: 24px;"></i>
                        <div>
                            <strong>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</strong>
                            <p style="margin-top: 5px;">${error.message}</p>
                        </div>
                    </div>
                `;
                
                showNotification('‚ùå ' + error.message, 'error');
            }
        }

        // Update Sheets Status
        function updateSheetsStatus(connected) {
            const statusEl = document.getElementById('sheetsStatus');
            if (connected) {
                statusEl.innerHTML = `
                    <span class="config-status connected">
                        <i class="fas fa-check-circle"></i>
                        ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß
                    </span>
                `;
            } else {
                statusEl.innerHTML = `
                    <span class="config-status disconnected">
                        <i class="fas fa-times-circle"></i>
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                    </span>
                `;
            }
        }

        // Save Settings
        function saveSettings() {
            let webAppUrl = document.getElementById('webAppUrl').value.trim();
            const companyName = document.getElementById('companyName').value;
            
            // ‚≠ê ‡∏ñ‡πâ‡∏≤ input ‡∏ß‡πà‡∏≤‡∏á ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ default
            if (!webAppUrl) {
                webAppUrl = GOOGLE_APPS_SCRIPT_URL;
            }
            
            sheetsConfig = { webAppUrl, sheetName: 'Assets' };
            localStorage.setItem('fmcgSheetsConfig', JSON.stringify(sheetsConfig));
            localStorage.setItem('fmcgCompanyName', companyName);
            
            showNotification('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        // Export to PDF with Beautiful Charts - Single Page
        async function exportToPDF() {
            if (assetsData.length === 0) {
                showNotification('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ Export', 'warning');
                return;
            }

            showLoading();

            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á hidden container ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö charts
                const chartContainer = document.createElement('div');
                chartContainer.style.position = 'absolute';
                chartContainer.style.left = '-9999px';
                chartContainer.style.width = '794px'; // A4 width in pixels (210mm * 3.78)
                chartContainer.style.height = '1123px'; // A4 height in pixels (297mm * 3.78)
                chartContainer.style.background = 'white';
                chartContainer.style.padding = '30px';
                chartContainer.style.boxSizing = 'border-box';
                document.body.appendChild(chartContainer);

                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                const stats = calculateStatistics();
                
                // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏Ñ‡πà Top 3)
                const topCategories = stats.categoryData.slice(0, 3);
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PDF - ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö
                chartContainer.innerHTML = `
                    <div style="font-family: 'Prompt', sans-serif; height: 100%; display: flex; flex-direction: column;">
                        <!-- Header - ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö -->
                        <div style="text-align: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 3px solid #14b8a6;">
                            <h1 style="color: #14b8a6; font-size: 24px; margin-bottom: 5px; margin-top: 0;">
                                üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                            </h1>
                            <p style="color: #666; font-size: 12px; margin: 0;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date().toLocaleDateString('th-TH', { 
                                year: 'numeric', 
                                month: 'long', 
                                day: 'numeric' 
                            })}</p>
                        </div>

                        <!-- Summary Cards - ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÇ‡∏ó‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏° -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 15px;">
                            <div style="background: linear-gradient(135deg, #0d9488 0%, #0f766e 100%); padding: 15px; border-radius: 10px; color: white; text-align: center; box-shadow: 0 2px 8px rgba(13, 148, 136, 0.3);">
                                <div style="font-size: 24px; font-weight: bold; margin-bottom: 4px;">${stats.totalCount}</div>
                                <div style="font-size: 11px; opacity: 0.9;">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #d97706 0%, #b45309 100%); padding: 15px; border-radius: 10px; color: white; text-align: center; box-shadow: 0 2px 8px rgba(217, 119, 6, 0.3);">
                                <div style="font-size: 24px; font-weight: bold; margin-bottom: 4px;">‡∏ø${stats.totalAmount.toLocaleString()}</div>
                                <div style="font-size: 11px; opacity: 0.9;">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%); padding: 15px; border-radius: 10px; color: white; text-align: center; box-shadow: 0 2px 8px rgba(30, 64, 175, 0.3);">
                                <div style="font-size: 24px; font-weight: bold; margin-bottom: 4px;">‡∏ø${Math.round(stats.avgAmount).toLocaleString()}</div>
                                <div style="font-size: 11px; opacity: 0.9;">‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #475569 0%, #334155 100%); padding: 15px; border-radius: 10px; color: white; text-align: center; box-shadow: 0 2px 8px rgba(71, 85, 105, 0.3);">
                                <div style="font-size: 24px; font-weight: bold; margin-bottom: 4px;">${stats.categoryCount}</div>
                                <div style="font-size: 11px; opacity: 0.9;">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</div>
                            </div>
                        </div>


                        <!-- Charts - ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <!-- Bar Chart -->
                            <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 15px rgba(0,0,0,0.08);">
                                <h2 style="color: #333; font-size: 14px; margin: 0 0 10px 0; display: flex; align-items: center; gap: 8px;">
                                    <span style="color: #14b8a6;">üìä</span>
                                    ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
                                </h2>
                                <canvas id="pdfBarChart" width="340" height="220"></canvas>
                            </div>

                            <!-- Pie Chart -->
                            <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 15px rgba(0,0,0,0.08);">
                                <h2 style="color: #333; font-size: 14px; margin: 0 0 10px 0; display: flex; align-items: center; gap: 8px;">
                                    <span style="color: #f59e0b;">ü•ß</span>
                                    ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
                                </h2>
                                <div style="display: flex; justify-content: center; align-items: center; height: 220px;">
                                    <canvas id="pdfPieChart" width="240" height="220"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Top Categories Table - ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏Ñ‡πà Top 5 -->
                        <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 15px rgba(0,0,0,0.08); flex: 1;">
                            <h2 style="color: #333; font-size: 14px; margin: 0 0 10px 0; display: flex; align-items: center; gap: 8px;">
                                <span style="color: #14b8a6;">üèÜ</span>
                                ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (Top ${topCategories.length})
                            </h2>
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #f0fdfa; border-bottom: 2px solid #14b8a6;">
                                        <th style="padding: 10px 8px; text-align: left; color: #0d9488; font-size: 11px; font-weight: 600;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                                        <th style="padding: 10px 8px; text-align: left; color: #0d9488; font-size: 11px; font-weight: 600;">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                        <th style="padding: 10px 8px; text-align: center; color: #0d9488; font-size: 11px; font-weight: 600;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                        <th style="padding: 10px 8px; text-align: right; color: #0d9488; font-size: 11px; font-weight: 600;">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°</th>
                                        <th style="padding: 10px 8px; text-align: right; color: #0d9488; font-size: 11px; font-weight: 600;">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${topCategories.map((item, index) => {
                                        // Top 3 ‡πÉ‡∏ä‡πâ font weight bold ‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏°
                                        const isTop3 = index < 3;
                                        const fontWeight = isTop3 ? 'bold' : 'normal';
                                        const nameColor = isTop3 ? '#0d9488' : '#64748b';
                                        const valueColor = isTop3 ? '#0d9488' : '#94a3b8';
                                        
                                        return `
                                        <tr style="border-bottom: 1px solid #e5e5e5;">
                                            <td style="padding: 10px 8px; font-size: 11px; color: #666; font-weight: ${fontWeight};">${index + 1}</td>
                                            <td style="padding: 10px 8px; font-weight: ${fontWeight}; font-size: 11px; color: ${nameColor};">
                                                <span style="display: inline-block; width: 8px; height: 8px; background: ${item.color}; border-radius: 50%; margin-right: 6px;"></span>
                                                ${item.name}
                                            </td>
                                            <td style="padding: 10px 8px; text-align: center; font-size: 11px; color: #666;">${item.count}</td>
                                            <td style="padding: 10px 8px; text-align: right; font-weight: ${fontWeight}; font-size: 11px; color: ${valueColor};">‡∏ø${item.value.toLocaleString()}</td>
                                            <td style="padding: 10px 8px; text-align: right; font-size: 11px; color: #666;">${item.percentage.toFixed(1)}%</td>
                                        </tr>
                                    `}).join('')}
                                </tbody>
                            </table>
                        </div>

                        <!-- Footer - ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö -->
                        <div style="margin-top: 10px; padding-top: 8px; border-top: 1px solid #e5e5e5; text-align: center; color: #999; font-size: 9px;">
                            <p style="margin: 0;">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ | ¬© ${new Date().getFullYear()}</p>
                        </div>
                    </div>
                `;

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü Bar Chart - ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö
                const barCtx = document.getElementById('pdfBarChart').getContext('2d');
                new Chart(barCtx, {
                    type: 'bar',
                    data: {
                        labels: stats.categoryData.map(item => item.name),
                        datasets: [{
                            label: '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)',
                            data: stats.categoryData.map(item => item.value),
                            backgroundColor: stats.categoryData.map(item => item.color),
                            borderColor: stats.categoryData.map(item => item.color),
                            borderWidth: 1,
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    font: { size: 9 },
                                    callback: function(value) {
                                        return '‡∏ø' + (value / 1000).toFixed(0) + 'K';
                                    }
                                },
                                grid: {
                                    color: 'rgba(0,0,0,0.05)'
                                }
                            },
                            x: {
                                ticks: {
                                    font: { size: 9 }
                                },
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü Pie Chart - ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö
                const pieCtx = document.getElementById('pdfPieChart').getContext('2d');
                new Chart(pieCtx, {
                    type: 'doughnut',
                    data: {
                        labels: stats.categoryData.map(item => item.name),
                        datasets: [{
                            data: stats.categoryData.map(item => item.value),
                            backgroundColor: stats.categoryData.map(item => item.color),
                            borderColor: '#fff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    padding: 8,
                                    font: { size: 9 },
                                    boxWidth: 12,
                                    boxHeight: 12
                                }
                            },
                            tooltip: { enabled: false }
                        }
                    }
                });

                // ‡∏£‡∏≠‡πÉ‡∏´‡πâ charts render ‡πÄ‡∏™‡∏£‡πá‡∏à
                await new Promise(resolve => setTimeout(resolve, 1000));

                // ‡πÅ‡∏õ‡∏•‡∏á HTML ‡πÄ‡∏õ‡πá‡∏ô canvas
                const canvas = await html2canvas(chartContainer, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff',
                    width: 794,
                    height: 1123
                });

                // ‡∏•‡∏ö container
                document.body.removeChild(chartContainer);

                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏•‡∏á PDF - ‡∏û‡∏≠‡∏î‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = pageWidth - 20;
                const imgHeight = pageHeight - 20;
                
                pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);

                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå
                const date = new Date().toISOString().split('T')[0];
                pdf.save(`Report_Charts_${date}.pdf`);

                hideLoading();
                showNotification('‚úÖ Export PDF ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');

            } catch (error) {
                console.error('Export PDF Error:', error);
                hideLoading();
                showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Export PDF: ' + error.message, 'error');
            }
        }

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
        function calculateStatistics() {
            const categoryMap = {};
            let totalAmount = 0;
            
            assetsData.forEach(asset => {
                const category = asset.category || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                const price = parseFloat(asset.price) || 0;
                
                if (!categoryMap[category]) {
                    categoryMap[category] = { count: 0, value: 0 };
                }
                
                categoryMap[category].count++;
                categoryMap[category].value += price;
                totalAmount += price;
            });

            // ‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Top 3 - ‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏°‡πÇ‡∏î‡∏î‡πÄ‡∏î‡πà‡∏ô
            const top3Colors = [
                '#0d9488',  // Teal ‡πÄ‡∏Ç‡πâ‡∏°
                '#d97706',  // Orange ‡πÄ‡∏Ç‡πâ‡∏°
                '#1e40af'   // Blue ‡πÄ‡∏Ç‡πâ‡∏° (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å Green)
            ];
            
            // ‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡πÜ - ‡πÇ‡∏ó‡∏ô‡∏™‡∏µ‡πÄ‡∏ó‡∏≤
            const otherColors = [
                '#94a3b8',  // Slate 400
                '#cbd5e1',  // Slate 300
                '#e2e8f0',  // Slate 200
                '#f1f5f9',  // Slate 100
                '#f8fafc'   // Slate 50
            ];

            const categoryData = Object.keys(categoryMap)
                .map((key, index) => ({
                    name: key,
                    count: categoryMap[key].count,
                    value: categoryMap[key].value,
                    percentage: (categoryMap[key].value / totalAmount) * 100,
                    color: index < 3 ? top3Colors[index] : otherColors[index - 3] || '#f1f5f9'
                }))
                .sort((a, b) => b.value - a.value);

            return {
                totalCount: assetsData.length,
                totalAmount: totalAmount,
                avgAmount: assetsData.length > 0 ? totalAmount / assetsData.length : 0,
                categoryCount: Object.keys(categoryMap).length,
                categoryData: categoryData
            };
        }

        // Export to Excel
        function exportToExcel() {
            if (assetsData.length === 0) {
                showNotification('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ Export', 'warning');
                return;
            }
            
            const data = assetsData.map(asset => ({
                '‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô': asset.code,
                '‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô': asset.name,
                '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà': asset.category,
                '‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠': asset.brand,
                '‡∏£‡∏∏‡πà‡∏ô': asset.model,
                'Serial Number': asset.serial,
                '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠': asset.purchaseDate,
                '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠': asset.price,
                '‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö': asset.location,
                '‡πÅ‡∏ú‡∏ô‡∏Å': asset.department || '',
                '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞': asset.status,
                '‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢': asset.description
            }));
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Assets');
            
            const date = new Date().toISOString().split('T')[0];
            XLSX.writeFile(wb, `Asset_Export_${date}.xlsx`);
            
            showNotification('‚úÖ Export Excel ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        // Show Notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const title = document.getElementById('notificationTitle');
            const msg = document.getElementById('notificationMessage');
            
            notification.className = 'notification active ' + type;
            
            if (type === 'success') {
                title.innerHTML = '<i class="fas fa-check-circle"></i> ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
            } else if (type === 'error') {
                title.innerHTML = '<i class="fas fa-times-circle"></i> ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î';
            } else {
                title.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô';
            }
            
            msg.textContent = message;
            
            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }

        // Loading Functions
        function showLoading() {
            document.getElementById('loading').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('active');
        }

        // Initialize on load
        window.addEventListener('load', function() {
            // Load data from localStorage
            const savedAssets = localStorage.getItem('fmcgAssets');
            if (savedAssets) {
                assetsData = JSON.parse(savedAssets);
            }
            
            const savedConfig = localStorage.getItem('fmcgSheetsConfig');
            if (savedConfig) {
                sheetsConfig = JSON.parse(savedConfig);
                document.getElementById('webAppUrl').value = sheetsConfig.webAppUrl;
                updateSheetsStatus(true);
            } else {
                // ‚≠ê ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ localStorage ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ default
                document.getElementById('webAppUrl').value = GOOGLE_APPS_SCRIPT_URL;
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ß‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏µ URL default)
                if (GOOGLE_APPS_SCRIPT_URL) {
                    updateSheetsStatus(true);
                }
            }
            
            const savedCompany = localStorage.getItem('fmcgCompanyName');
            if (savedCompany) {
                document.getElementById('companyName').value = savedCompany;
            }
            
            initDashboardCharts();
            updateDashboard();

            // Initialize other pages if there's data
            if (assetsData.length > 0) {
                updateDepartmentPage();
                updateLocationsPage();
                updateMaintenancePage();
                updateReportsPage();
            }
        });

        // Close modal on outside click
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.classList.remove('active');
                }
            });
        };
    </script>
</body>
</html>
